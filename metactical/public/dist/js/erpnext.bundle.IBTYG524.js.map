{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/erpnext/public/js/conf.js", "../../../../../apps/erpnext/erpnext/public/js/utils.js", "../../../../../apps/metactical/metactical/custom_scripts/public/erpnext/utils.js", "../../../../../apps/erpnext/erpnext/public/js/queries.js", "../../../../../apps/erpnext/erpnext/public/js/sms_manager.js", "../../../../../apps/erpnext/erpnext/public/js/utils/party.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js", "../../../../../apps/erpnext/erpnext/public/js/payment/payments.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js", "../../../../../apps/erpnext/erpnext/public/js/controllers/transaction.js", "../../../../../apps/metactical/metactical/custom_scripts/public/erpnext/transaction.js", "frappe-html:/media/n/Files/projects/metactical_v14/apps/metactical/metactical/erpnext_public/js/templates/item_selector.html", "../../../../../apps/erpnext/erpnext/public/js/utils/item_selector.js", "../../../../../apps/erpnext/erpnext/public/js/help_links.js", "../../../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js", "frappe-html:/media/n/Files/projects/metactical_v14/apps/metactical/metactical/erpnext_public/js/templates/item_quick_entry.html", "../../../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/contact_address_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/utils/supplier_quick_entry.js", "../../../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js", "../../../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js", "../../../../../apps/erpnext/erpnext/public/js/utils/unreconcile.js", "../../../../../apps/erpnext/erpnext/public/js/utils/barcode_scanner.js", "../../../../../apps/erpnext/erpnext/public/js/telephony.js", "frappe-html:/media/n/Files/projects/metactical_v14/apps/metactical/metactical/erpnext_public/js/templates/call_link.html", "../../../../../apps/erpnext/erpnext/public/js/bulk_transaction_processing.js", "../../../../../apps/erpnext/erpnext/public/js/utils/crm_activities.js", "frappe-html:/media/n/Files/projects/metactical_v14/apps/metactical/metactical/erpnext_public/js/templates/crm_activities.html", "frappe-html:/media/n/Files/projects/metactical_v14/apps/metactical/metactical/erpnext_public/js/templates/crm_notes.html"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext\");\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\tTerritory: \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\tBrand: \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\",\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t\"ERPNext Integrations\": \"Integrations\",\n\tGeo: \"Settings\",\n\tPortal: \"Website\",\n\tUtilities: \"Settings\",\n\t\"E-commerce\": \"Website\",\n\tContacts: \"CRM\",\n});\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\nfrappe.provide(\"erpnext.stock.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function (company) {\n\t\tif (!company && cur_frm) company = cur_frm.doc.company;\n\t\tif (company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse return frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter((d) => d.doctype === \":Currency\").map((d) => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function () {\n\t\tif (cur_frm && cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal ? true : false);\n\t\t}\n\t},\n\n\thide_company: function () {\n\t\tif (cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif (companies.length === 1) {\n\t\t\t\tif (!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if (erpnext.last_selected_company) {\n\t\t\t\tif (!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function (company) {\n\t\tif (company) {\n\t\t\tlet company_local = locals[\":Company\"] && locals[\":Company\"][company];\n\t\t\tif (company_local) {\n\t\t\t\treturn cint(company_local.enable_perpetual_inventory);\n\t\t\t}\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_or_batch_no: function () {\n\t\tlet grid_row = cur_frm.open_grid_row();\n\t\tif (\n\t\t\t!grid_row ||\n\t\t\t!grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status() !== \"Write\"\n\t\t)\n\t\t\treturn;\n\n\t\tfrappe.model.get_value(\n\t\t\t\"Item\",\n\t\t\t{ name: grid_row.doc.item_code },\n\t\t\t[\"has_serial_no\", \"has_batch_no\"],\n\t\t\t({ has_serial_no, has_batch_no }) => {\n\t\t\t\tObject.assign(grid_row.doc, { has_serial_no, has_batch_no });\n\n\t\t\t\tif (has_serial_no) {\n\t\t\t\t\tattach_selector_button(\n\t\t\t\t\t\t__(\"Add Serial No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.serial_no.$wrapper,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tgrid_row\n\t\t\t\t\t);\n\t\t\t\t} else if (has_batch_no) {\n\t\t\t\t\tattach_selector_button(\n\t\t\t\t\t\t__(\"Pick Batch No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.batch_no.$wrapper,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tgrid_row\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t},\n\n\troute_to_adjustment_jv: (args) => {\n\t\tfrappe.model.with_doctype(\"Journal Entry\", () => {\n\t\t\t// route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n\t\t\tlet journal_entry = frappe.model.get_new_doc(\"Journal Entry\");\n\n\t\t\targs.accounts.forEach((je_account) => {\n\t\t\t\tlet child_row = frappe.model.add_child(journal_entry, \"accounts\");\n\t\t\t\tchild_row.account = je_account.account;\n\t\t\t\tchild_row.debit_in_account_currency = je_account.debit_in_account_currency;\n\t\t\t\tchild_row.credit_in_account_currency = je_account.credit_in_account_currency;\n\t\t\t\tchild_row.party_type = \"\";\n\t\t\t});\n\t\t\tfrappe.set_route(\"Form\", \"Journal Entry\", journal_entry.name);\n\t\t});\n\t},\n\n\troute_to_pending_reposts: (args) => {\n\t\tfrappe.set_route(\"List\", \"Repost Item Valuation\", args);\n\t},\n});\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function (frm) {\n\t\tif (frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif (company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function (info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(\n\t\t\t\t\t__(\"Annual Billing: {0}\", [\n\t\t\t\t\t\tformat_currency(\n\t\t\t\t\t\t\tcompany_wise_info[0].billing_this_year,\n\t\t\t\t\t\t\tcompany_wise_info[0].currency\n\t\t\t\t\t\t),\n\t\t\t\t\t]),\n\t\t\t\t\t\"blue\"\n\t\t\t\t);\n\t\t\t\tfrm.dashboard.add_indicator(\n\t\t\t\t\t__(\"Total Unpaid: {0}\", [\n\t\t\t\t\t\tformat_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency),\n\t\t\t\t\t]),\n\t\t\t\t\tcompany_wise_info[0].total_unpaid ? \"orange\" : \"green\"\n\t\t\t\t);\n\n\t\t\t\tif (company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(\n\t\t\t\t\t\t__(\"Loyalty Points: {0}\", [company_wise_info[0].loyalty_points]),\n\t\t\t\t\t\t\"blue\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function (frm, info) {\n\t\tfrm.dashboard.stats_area.show();\n\t\tfrm.dashboard.stats_area_row.addClass(\"flex\");\n\t\tfrm.dashboard.stats_area_row.css(\"flex-wrap\", \"wrap\");\n\n\t\tvar color = info.total_unpaid ? \"orange\" : \"green\";\n\n\t\tvar indicator = $(\n\t\t\t'<div class=\"flex-column col-xs-6\">' +\n\t\t\t\t'<div style=\"margin-top:10px\"><h6>' +\n\t\t\t\tinfo.company +\n\t\t\t\t\"</h6></div>\" +\n\t\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">' +\n\t\t\t\t\"Annual Billing: \" +\n\t\t\t\tformat_currency(info.billing_this_year, info.currency) +\n\t\t\t\t\"</span></div>\" +\n\t\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">' +\n\t\t\t\t'<span class=\"indicator ' +\n\t\t\t\tcolor +\n\t\t\t\t'\">Total Unpaid: ' +\n\t\t\t\tformat_currency(info.total_unpaid, info.currency) +\n\t\t\t\t\"</span></div>\" +\n\t\t\t\t\"</div>\"\n\t\t).appendTo(frm.dashboard.stats_area_row);\n\n\t\tif (info.loyalty_points) {\n\t\t\t$(\n\t\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">' +\n\t\t\t\t\t\"Loyalty Points: \" +\n\t\t\t\t\tinfo.loyalty_points +\n\t\t\t\t\t\"</span></div>\"\n\t\t\t).appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function (party_type) {\n\t\tvar dict = {\n\t\t\tCustomer: \"customer_name\",\n\t\t\tSupplier: \"supplier_name\",\n\t\t\tEmployee: \"employee_name\",\n\t\t\tMember: \"member_name\",\n\t\t};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function (doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif (d[fieldname]) {\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor (var i = 0; i < cl.length; i++) {\n\t\t\t\tif (!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function (tc_name, doc, callback) {\n\t\tif (tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions\",\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function (doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname,\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function (r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t},\n\t\t});\n\t},\n\n\tadd_dimensions: function (report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\tcallback: function (r) {\n\t\t\t\tlet accounting_dimensions = r.message[0];\n\t\t\t\taccounting_dimensions.forEach((dimension) => {\n\t\t\t\t\tlet found = filters.some((el) => el.fieldname === dimension[\"fieldname\"]);\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\tfieldname: dimension[\"fieldname\"],\n\t\t\t\t\t\t\tlabel: __(dimension[\"label\"]),\n\t\t\t\t\t\t\tfieldtype: \"MultiSelectList\",\n\t\t\t\t\t\t\tget_data: function (txt) {\n\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"document_type\"], txt);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t},\n\n\tadd_inventory_dimensions: function (report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.stock.doctype.inventory_dimension.inventory_dimension.get_inventory_dimensions\",\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message && r.message.length) {\n\t\t\t\t\tr.message.forEach((dimension) => {\n\t\t\t\t\t\tlet existing_filter = filters.filter((el) => el.fieldname === dimension[\"fieldname\"]);\n\n\t\t\t\t\t\tif (!existing_filter.length) {\n\t\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\t\tfieldname: dimension[\"fieldname\"],\n\t\t\t\t\t\t\t\tlabel: __(dimension[\"doctype\"]),\n\t\t\t\t\t\t\t\tfieldtype: \"MultiSelectList\",\n\t\t\t\t\t\t\t\tget_data: function (txt) {\n\t\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"doctype\"], txt);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texisting_filter[0][\"fieldtype\"] = \"MultiSelectList\";\n\t\t\t\t\t\t\texisting_filter[0][\"get_data\"] = function (txt) {\n\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"doctype\"], txt);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\n\tmake_subscription: function (doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t},\n\t\t});\n\t},\n\n\tmake_pricing_rule: function (doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t},\n\t\t});\n\t},\n\n\t/**\n\t * Checks if the first row of a given child table is empty\n\t * @param child_table - Child table Doctype\n\t * @return {Boolean}\n\t **/\n\tfirst_row_is_empty: function (child_table) {\n\t\tif ($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Removes the first row of a child table if it is empty\n\t * @param {_Frm} frm - The current form\n\t * @param {String} child_table_name - The child table field name\n\t * @return {Boolean}\n\t **/\n\tremove_empty_first_row: function (frm, child_table_name) {\n\t\tconst rows = frm[\"doc\"][child_table_name];\n\t\tif (this.first_row_is_empty(rows)) {\n\t\t\tfrm[\"doc\"][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function (option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif (user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map((perm) => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function (c) {\n\t\t\t\treturn c.name;\n\t\t\t}).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function (option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif (options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\toverrides_parent_value_in_all_rows: function (doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tif (doc[parent_fieldname]) {\n\t\t\tlet cl = doc[table_fieldname] || [];\n\t\t\tfor (let i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t\tfrappe.refresh_field(table_fieldname);\n\t\t}\n\t},\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t},\n\n\t// check if payments app is installed on site, if not warn user.\n\tcheck_payments_app: () => {\n\t\tif (frappe.boot.versions && !frappe.boot.versions.payments) {\n\t\t\tconst marketplace_link =\n\t\t\t\t'<a href=\"https://frappecloud.com/marketplace/apps/payments\">Marketplace</a>';\n\t\t\tconst github_link = '<a href=\"https://github.com/frappe/payments/\">GitHub</a>';\n\t\t\tconst msg = __(\"payments app is not installed. Please install it from {0} or {1}\", [\n\t\t\t\tmarketplace_link,\n\t\t\t\tgithub_link,\n\t\t\t]);\n\t\t\tfrappe.msgprint(msg);\n\t\t}\n\t},\n\n\tget_fiscal_year: function (date, with_dates = false, boolean = false) {\n\t\tif (!frappe.boot.setup_complete) {\n\t\t\treturn;\n\t\t}\n\t\tif (!date) {\n\t\t\tdate = frappe.datetime.get_today();\n\t\t}\n\n\t\tlet fiscal_year = \"\";\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.utils.get_fiscal_year\",\n\t\t\targs: {\n\t\t\t\tdate: date,\n\t\t\t\tboolean: boolean,\n\t\t\t},\n\t\t\tasync: false,\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tif (with_dates) fiscal_year = r.message;\n\t\t\t\t\telse fiscal_year = r.message[0];\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\treturn fiscal_year;\n\t},\n});\n\nerpnext.utils.select_alternate_items = function (opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || \"warehouse\";\n\tconst item_field = opts.item_field || \"item_code\";\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{ fieldtype: \"Section Break\", label: __(\"Items\") },\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\toptions: \"Item\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tfieldname: \"alternate_item\",\n\t\t\t\t\t\toptions: \"Item\",\n\t\t\t\t\t\tdefault: \"\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __(\"Alternate Item\"),\n\t\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\t\twarehouse: warehouse,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict.actual_qty.set_value(\n\t\t\t\t\t\t\t\t\t\t\tr.message || 0\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\titem_code: e.item_code,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\t\tfieldname: \"warehouse\",\n\t\t\t\t\t\toptions: \"Warehouse\",\n\t\t\t\t\t\tdefault: \"\",\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __(\"Warehouse\"),\n\t\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\t\twarehouse: warehouse,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict.actual_qty.set_value(\n\t\t\t\t\t\t\t\t\t\t\tr.message || 0\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"actual_qty\",\n\t\t\t\t\t\tdefault: 0,\n\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\t\tlabel: __(\"Available Qty\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t\tprimary_action: function () {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter((d) => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach((d) => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === \"Work Order Item\") {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, \"qty\", qty);\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, opts.original_item_field, d.item_code);\n\t\t\t\tfrm.trigger(item_field, row.doctype, row.name);\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __(\"Update\"),\n\t});\n\n\tfrm.doc[opts.child_docname].forEach((d) => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\tdocname: d.name,\n\t\t\t\titem_code: d[item_field],\n\t\t\t\twarehouse: d[warehouse_field],\n\t\t\t\tactual_qty: d.actual_qty,\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n};\n\nerpnext.utils.update_child_items = function (opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = typeof opts.cannot_add_row === \"undefined\" ? true : opts.cannot_add_row;\n\tconst child_docname = typeof opts.cannot_add_row === \"undefined\" ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst get_precision = (fieldname) => child_meta.fields.find((f) => f.fieldname == fieldname).precision;\n\n\tthis.data = frm.doc[opts.child_docname].map((d) => {\n\t\treturn {\n\t\t\tdocname: d.name,\n\t\t\tname: d.name,\n\t\t\titem_code: d.item_code,\n\t\t\tdelivery_date: d.delivery_date,\n\t\t\tschedule_date: d.schedule_date,\n\t\t\tconversion_factor: d.conversion_factor,\n\t\t\tqty: d.qty,\n\t\t\trate: d.rate,\n\t\t\tuom: d.uom,\n\t\t};\n\t});\n\n\tconst fields = [\n\t\t{\n\t\t\tfieldtype: \"Data\",\n\t\t\tfieldname: \"docname\",\n\t\t\tread_only: 1,\n\t\t\thidden: 1,\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Link\",\n\t\t\tfieldname: \"item_code\",\n\t\t\toptions: \"Item\",\n\t\t\tin_list_view: 1,\n\t\t\tread_only: 0,\n\t\t\tdisabled: 0,\n\t\t\tlabel: __(\"Item Code\"),\n\t\t\tget_query: function () {\n\t\t\t\tlet filters;\n\t\t\t\tif (frm.doc.doctype == \"Sales Order\") {\n\t\t\t\t\tfilters = { is_sales_item: 1 };\n\t\t\t\t} else if (frm.doc.doctype == \"Purchase Order\") {\n\t\t\t\t\tif (frm.doc.is_subcontracted) {\n\t\t\t\t\t\tif (frm.doc.is_old_subcontracting_flow) {\n\t\t\t\t\t\t\tfilters = { is_sub_contracted_item: 1 };\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters = { is_stock_item: 0 };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilters = { is_purchase_item: 1 };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\t\tfilters: filters,\n\t\t\t\t};\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Link\",\n\t\t\tfieldname: \"uom\",\n\t\t\toptions: \"UOM\",\n\t\t\tread_only: 0,\n\t\t\tlabel: __(\"UOM\"),\n\t\t\treqd: 1,\n\t\t\tonchange: function () {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some((doc) => {\n\t\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Float\",\n\t\t\tfieldname: \"qty\",\n\t\t\tdefault: 0,\n\t\t\tread_only: 0,\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Qty\"),\n\t\t\tprecision: get_precision(\"qty\"),\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Currency\",\n\t\t\tfieldname: \"rate\",\n\t\t\toptions: \"currency\",\n\t\t\tdefault: 0,\n\t\t\tread_only: 0,\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Rate\"),\n\t\t\tprecision: get_precision(\"rate\"),\n\t\t},\n\t];\n\n\tif (frm.doc.doctype == \"Sales Order\" || frm.doc.doctype == \"Purchase Order\") {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: \"Date\",\n\t\t\tfieldname: frm.doc.doctype == \"Sales Order\" ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == \"Sales Order\" ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\treqd: 1,\n\t\t});\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: \"Float\",\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision(\"conversion_factor\"),\n\t\t});\n\t}\n\n\tnew frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tsize: \"extra-large\",\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: false,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields,\n\t\t\t},\n\t\t],\n\t\tprimary_action: function () {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"].filter((item) => !!item.item_code);\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.update_child_qty_rate\",\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\tparent_doctype: frm.doc.doctype,\n\t\t\t\t\ttrans_items: trans_items,\n\t\t\t\t\tparent_doctype_name: frm.doc.name,\n\t\t\t\t\tchild_docname: child_docname,\n\t\t\t\t},\n\t\t\t\tcallback: function () {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __(\"Update\"),\n\t}).show();\n};\n\nerpnext.utils.map_current_doc = function (opts) {\n\tfunction _map() {\n\t\tif ($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif (!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, \"items\").options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function (d) {\n\t\t\t\tif (d.options === opts.source_doctype) link_fieldname = d.fieldname;\n\t\t\t});\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function (i, d) {\n\t\t\t\topts.source_name.forEach(function (src) {\n\t\t\t\t\tif (d[link_fieldname] == src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code]) item_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse item_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (already_set) {\n\t\t\t\topts.source_name.forEach(function (src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function (r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function (i, row) {\n\t\t\t\t\t\t\tif (row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tif (already_set) {\n\t\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t\t__(\"You have already selected items from {0} {1}\", [opts.source_doctype, src])\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: \"frappe.model.mapper.map_docs\",\n\t\t\targs: {\n\t\t\t\tmethod: opts.method,\n\t\t\t\tsource_names: opts.source_name,\n\t\t\t\ttarget_doc: cur_frm.doc,\n\t\t\t\targs: opts.args,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tlet query_args = {};\n\tif (opts.get_query_filters) {\n\t\tquery_args.filters = opts.get_query_filters;\n\t}\n\n\tif (opts.get_query_method) {\n\t\tquery_args.query = opts.get_query_method;\n\t}\n\n\tif (query_args.filters || query_args.query) {\n\t\topts.get_query = () => query_args;\n\t}\n\n\tif (opts.source_doctype) {\n\t\tlet data_fields = [];\n\t\tif ([\"Purchase Receipt\", \"Delivery Note\"].includes(opts.source_doctype)) {\n\t\t\tlet target_meta = frappe.get_meta(cur_frm.doc.doctype);\n\t\t\tif (target_meta.fields.find((f) => f.fieldname === \"taxes\")) {\n\t\t\t\tdata_fields.push({\n\t\t\t\t\tfieldname: \"merge_taxes\",\n\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t\tlabel: __(\"Merge taxes from multiple documents\"),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tconst d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tdata_fields: data_fields,\n\t\t\tget_query: opts.get_query,\n\t\t\tadd_filters_group: 1,\n\t\t\tallow_child_item_selection: opts.allow_child_item_selection,\n\t\t\tchild_fieldname: opts.child_fieldname,\n\t\t\tchild_columns: opts.child_columns,\n\t\t\tsize: opts.size,\n\t\t\taction: function (selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif (values.length === 0) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\tif (\n\t\t\t\t\topts.allow_child_item_selection ||\n\t\t\t\t\t[\"Purchase Receipt\", \"Delivery Note\"].includes(opts.source_doctype)\n\t\t\t\t) {\n\t\t\t\t\t// args contains filtered child docnames\n\t\t\t\t\topts.args = args;\n\t\t\t\t}\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\n\t\treturn d;\n\t}\n\n\tif (opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n};\n\nfrappe.form.link_formatters[\"Item\"] = function (value, doc) {\n\tif (doc && value && doc.item_name && doc.item_name !== value && doc.item_code === value) {\n\t\treturn value + \": \" + doc.item_name;\n\t} else if (!value && doc.doctype && doc.item_name) {\n\t\t// format blank value in child table\n\t\treturn doc.item_name;\n\t} else {\n\t\t// if value is blank in report view or item code and name are the same, return as is\n\t\treturn value;\n\t}\n};\n\nfrappe.form.link_formatters[\"Employee\"] = function (value, doc) {\n\tif (doc && value && doc.employee_name && doc.employee_name !== value && doc.employee === value) {\n\t\treturn value + \": \" + doc.employee_name;\n\t} else if (!value && doc.doctype && doc.employee_name) {\n\t\t// format blank value in child table\n\t\treturn doc.employee;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n};\n\nfrappe.form.link_formatters[\"Project\"] = function (value, doc) {\n\tif (doc && value && doc.project_name && doc.project_name !== value && doc.project === value) {\n\t\treturn value + \": \" + doc.project_name;\n\t} else if (!value && doc.doctype && doc.project_name) {\n\t\t// format blank value in child table\n\t\treturn doc.project;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n};\n\n// add description on posting time\n$(document).on(\"app_ready\", function () {\n\tif (!frappe.datetime.is_timezone_same()) {\n\t\t$.each(\n\t\t\t[\n\t\t\t\t\"Stock Reconciliation\",\n\t\t\t\t\"Stock Entry\",\n\t\t\t\t\"Stock Ledger Entry\",\n\t\t\t\t\"Delivery Note\",\n\t\t\t\t\"Purchase Receipt\",\n\t\t\t\t\"Sales Invoice\",\n\t\t\t],\n\t\t\tfunction (i, d) {\n\t\t\t\tfrappe.ui.form.on(d, \"onload\", function (frm) {\n\t\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\", frappe.sys_defaults.time_zone);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n});\n\n// Show SLA dashboard\n$(document).on(\"app_ready\", function () {\n\t$.each(frappe.boot.service_level_agreement_doctypes, function (_i, d) {\n\t\tfrappe.ui.form.on(d, {\n\t\t\tonload: function (frm) {\n\t\t\t\tif (!frm.doc.service_level_agreement) return;\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.support.doctype.service_level_agreement.service_level_agreement.get_service_level_agreement_filters\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\t\tname: frm.doc.service_level_agreement,\n\t\t\t\t\t\tcustomer: frm.doc.customer,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r && r.message) {\n\t\t\t\t\t\t\tfrm.set_query(\"priority\", function () {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\tname: [\"in\", r.message.priority],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrm.set_query(\"service_level_agreement\", function () {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\t\tname: [\"in\", r.message.service_level_agreements],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\n\t\t\trefresh: function (frm) {\n\t\t\t\tif (\n\t\t\t\t\tfrm.doc.status !== \"Closed\" &&\n\t\t\t\t\tfrm.doc.service_level_agreement &&\n\t\t\t\t\t[\"First Response Due\", \"Resolution Due\"].includes(frm.doc.agreement_status)\n\t\t\t\t) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: \"Service Level Agreement\",\n\t\t\t\t\t\t\tname: frm.doc.service_level_agreement,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t\tlet statuses = data.message.pause_sla_on;\n\t\t\t\t\t\t\tconst hold_statuses = [];\n\t\t\t\t\t\t\t$.each(statuses, (_i, entry) => {\n\t\t\t\t\t\t\t\thold_statuses.push(entry.status);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (hold_statuses.includes(frm.doc.status)) {\n\t\t\t\t\t\t\t\tfrm.dashboard.clear_headline();\n\t\t\t\t\t\t\t\tlet message = {\n\t\t\t\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t\t\t\t\tmsg: __(\"SLA is on hold since {0}\", [\n\t\t\t\t\t\t\t\t\t\tmoment(frm.doc.on_hold_since).fromNow(true),\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t\t\t\t\t'<div class=\"col-xs-12\">' +\n\t\t\t\t\t\t\t\t\t\t'<span class=\"indicator whitespace-nowrap ' +\n\t\t\t\t\t\t\t\t\t\tmessage.indicator +\n\t\t\t\t\t\t\t\t\t\t'\"><span>' +\n\t\t\t\t\t\t\t\t\t\tmessage.msg +\n\t\t\t\t\t\t\t\t\t\t\"</span></span> \" +\n\t\t\t\t\t\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\t\t\t\t\t\"</div>\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tset_time_to_resolve_and_response(frm, data.message.apply_sla_for_resolution);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t} else if (frm.doc.service_level_agreement) {\n\t\t\t\t\tfrm.dashboard.clear_headline();\n\n\t\t\t\t\tlet agreement_status =\n\t\t\t\t\t\tfrm.doc.agreement_status == \"Fulfilled\"\n\t\t\t\t\t\t\t? { indicator: \"green\", msg: \"Service Level Agreement has been fulfilled\" }\n\t\t\t\t\t\t\t: { indicator: \"red\", msg: \"Service Level Agreement Failed\" };\n\n\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t'<div class=\"row\">' +\n\t\t\t\t\t\t\t'<div class=\"col-xs-12\">' +\n\t\t\t\t\t\t\t'<span class=\"indicator whitespace-nowrap ' +\n\t\t\t\t\t\t\tagreement_status.indicator +\n\t\t\t\t\t\t\t'\"><span class=\"hidden-xs\">' +\n\t\t\t\t\t\t\tagreement_status.msg +\n\t\t\t\t\t\t\t\"</span></span> \" +\n\t\t\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\t\t\"</div>\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t});\n});\n\nfunction set_time_to_resolve_and_response(frm, apply_sla_for_resolution) {\n\tfrm.dashboard.clear_headline();\n\n\tlet time_to_respond;\n\tif (!frm.doc.first_responded_on) {\n\t\ttime_to_respond = get_time_left(frm.doc.response_by, frm.doc.agreement_status);\n\t} else {\n\t\ttime_to_respond = get_status(frm.doc.response_by, frm.doc.first_responded_on);\n\t}\n\n\tlet alert = `\n\t\t<div class=\"row\">\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_respond.indicator}\">\n\t\t\t\t\t<span>Time to Respond: ${time_to_respond.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\n\tif (apply_sla_for_resolution) {\n\t\tlet time_to_resolve;\n\t\tif (!frm.doc.resolution_date) {\n\t\t\ttime_to_resolve = get_time_left(frm.doc.resolution_by, frm.doc.agreement_status);\n\t\t} else {\n\t\t\ttime_to_resolve = get_status(frm.doc.resolution_by, frm.doc.resolution_date);\n\t\t}\n\n\t\talert += `\n\t\t\t<div class=\"col-xs-12 col-sm-6\">\n\t\t\t\t<span class=\"indicator whitespace-nowrap ${time_to_resolve.indicator}\">\n\t\t\t\t\t<span>Time to Resolve: ${time_to_resolve.diff_display}</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n\n\talert += \"</div>\";\n\n\tfrm.dashboard.set_headline_alert(alert);\n}\n\nfunction get_time_left(timestamp, agreement_status) {\n\tconst diff = moment(timestamp).diff(frappe.datetime.system_datetime(true));\n\tconst diff_display = diff >= 44500 ? moment.duration(diff).humanize() : \"Failed\";\n\tlet indicator = diff_display == \"Failed\" && agreement_status != \"Fulfilled\" ? \"red\" : \"green\";\n\treturn { diff_display: diff_display, indicator: indicator };\n}\n\nfunction get_status(expected, actual) {\n\tconst time_left = moment(expected).diff(moment(actual));\n\tif (time_left >= 0) {\n\t\treturn { diff_display: \"Fulfilled\", indicator: \"green\" };\n\t} else {\n\t\treturn { diff_display: \"Failed\", indicator: \"red\" };\n\t}\n}\n\nfunction attach_selector_button(inner_text, append_loction, context, grid_row) {\n\tlet $btn_div = $(\"<div>\").css({ \"margin-bottom\": \"10px\", \"margin-top\": \"10px\" }).appendTo(append_loction);\n\tlet $btn = $(`<button class=\"btn btn-sm btn-default\">${inner_text}</button>`).appendTo($btn_div);\n\n\t$btn.on(\"click\", function () {\n\t\tcontext.show_serial_batch_selector(grid_row.frm, grid_row.doc, \"\", \"\", true);\n\t});\n}\n\n$.extend(erpnext.stock.utils, {\n\tset_item_details_using_barcode(frm, child_row, callback) {\n\t\tconst barcode_scanner = new erpnext.utils.BarcodeScanner({ frm: frm });\n\t\tbarcode_scanner.scan_api_call(child_row.barcode, callback);\n\t},\n});\n", "frappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = (typeof opts.cannot_add_row === 'undefined') ? true : opts.cannot_add_row;\n\tconst child_docname = (typeof opts.cannot_add_row === 'undefined') ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst get_precision = (fieldname) => child_meta.fields.find(f => f.fieldname == fieldname).precision;\n\n\tthis.data = [];\n\tconst fields = [{\n\t\tfieldtype:'Data',\n\t\tfieldname:\"docname\",\n\t\tread_only: 1,\n\t\thidden: 1,\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:\"item_code\",\n\t\toptions: 'Item',\n\t\tin_list_view: 1,\n\t\tread_only: 0,\n\t\tdisabled: 0,\n\t\tlabel: __('Item Code'),\n\t\tget_query: function() {\n\t\t\tlet filters;\n\t\t\tif (frm.doc.doctype == 'Sales Order') {\n\t\t\t\tfilters = {\"is_sales_item\": 1};\n\t\t\t} else if (frm.doc.doctype == 'Purchase Order') {\n\t\t\t\tif (frm.doc.is_subcontracted == \"Yes\") {\n\t\t\t\t\tfilters = {\"is_sub_contracted_item\": 1};\n\t\t\t\t} else {\n\t\t\t\t\tfilters = {\"is_purchase_item\": 1};\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\tfilters: filters\n\t\t\t};\n\t\t}\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:'uom',\n\t\toptions: 'UOM',\n\t\tread_only: 0,\n\t\tlabel: __('UOM'),\n\t\treqd: 1,\n\t\tonchange: function () {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\tcallback: r => {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some(doc => {\n\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tfieldtype:'Float',\n\t\tfieldname:\"qty\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Qty'),\n\t\tprecision: get_precision(\"qty\")\n\t}, {\n\t\tfieldtype:'Currency',\n\t\tfieldname:\"rate\",\n\t\toptions: \"currency\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Rate'),\n\t\tprecision: get_precision(\"rate\")\n\t}];\n\t\n\t// Metactical Customization: Add picked qty validation in Item Update\n\t// pop up so we don't reduce amount by amount already picked\n\t// Also add warehouse in pop up\n\tif (frm.doc.doctype == 'Sales Order') {\n\t\tfields.push(\n\t\t\t{\n\t\t\t\tfieldtype: 'Float',\n\t\t\t\tfieldname: 'picked_qty',\n\t\t\t\tdefault: 0,\n\t\t\t\tread_only: 1,\n\t\t\t\tin_list_view: 0,\n\t\t\t\tlabel: __('Picked Qty'),\n\t\t\t\tprecision: get_precision('picked_qty')\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\tfieldname: 'warehouse',\n\t\t\t\tread_only: 0,\n\t\t\t\tin_list_view: 1,\n\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\toptions: \"Warehouse\",\n\t\t\t\treqd: 1\n\t\t\t}\n\t\t);\n\t}\n\n\tif (frm.doc.doctype == 'Sales Order' || frm.doc.doctype == 'Purchase Order' ) {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: 'Date',\n\t\t\tfieldname: frm.doc.doctype == 'Sales Order' ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == 'Sales Order' ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\treqd: 1\n\t\t})\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: 'Float',\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tdefault: 1,\n\t\t\tin_list_view: 0,\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision('conversion_factor')\n\t\t})\n\t}\n\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: false,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\t// Metactical Customization: Add picked qty validation in Item Update\n\t\t\t// pop up so we don't reduce amount by amount already picked\n\t\t\t// Add already picked items in Sales orders\n\t\t\tif(frm.doc.doctype == 'Sales Order'){\n\t\t\t\tfrm.doc[opts.child_docname].forEach(d => {\n\t\t\t\t\tif(d.picked_qty == d.qty){\n\t\t\t\t\t\tthis.fields_dict.trans_items.df.data.push({\n\t\t\t\t\t\t\t\"docname\": d.name,\n\t\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\t\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\t\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\t\t\"rate\": d.rate,\n\t\t\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\t\t\"picked_qty\": d.picked_qty,\n\t\t\t\t\t\t\t\"warehouse\": d.warehouse\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"].filter((item) => !!item.item_code);\n\t\t\t// Metactical Customization: Add picked qty validation in Item Update\n\t\t\t// pop up so we don't reduce amount by amount already picked\n\t\t\t// Validate picked_qty < qty\n\t\t\tif(frm.doc.doctype == 'Sales Order'){\n\t\t\t\ttrans_items.forEach(row => {\n\t\t\t\t\tif(row.picked_qty > row.qty){\n\t\t\t\t\t\tfrappe.throw(\"Quantity can not be greater than the already picked qty for item \" + row.item_code);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Metactical Update: Point to custom update child qty rate in Metactical\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'metactical.custom_scripts.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name,\n\t\t\t\t\t'child_docname': child_docname\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\t// Metactical Customization: Add picked qty validation in Item Update\n\t\t// pop up so we don't reduce amount by amount already picked\n\t\tif(frm.doc.doctype == 'Sales Order' && d.picked_qty < d.qty){\n\t\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"name\": d.name,\n\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\"rate\": d.rate,\n\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\"picked_qty\": d.picked_qty,\n\t\t\t\t\"warehouse\": d.warehouse\n\t\t\t});\n\t\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t}\n\t\telse if(frm.doc.doctype != 'Sales Order'){\n\t\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"name\": d.name,\n\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\"rate\": d.rate,\n\t\t\t\t\"uom\": d.uom\n\t\t\t});\n\t\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t}\n\t})\n\tdialog.show();\n}\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function () {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function () {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function () {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function () {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function (filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif (filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function () {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function () {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function (doc) {\n\t\tif (!doc.customer) {\n\t\t\tfrappe.throw(\n\t\t\t\t__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))])\n\t\t\t);\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function (doc) {\n\t\tif (frappe.dynamic_link) {\n\t\t\tif (!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Please set {0}\", [\n\t\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name)),\n\t\t\t\t\t])\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: \"frappe.contacts.doctype.contact.contact.contact_query\",\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function (doc) {\n\t\tif (frappe.dynamic_link) {\n\t\t\tif (!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Please set {0}\", [\n\t\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name)),\n\t\t\t\t\t])\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function (doc) {\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: \"Company\", link_name: doc.company || \"\" },\n\t\t};\n\t},\n\n\tdispatch_address_query: function (doc) {\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\tfilters: { link_doctype: \"Company\", link_name: doc.company || \"\" },\n\t\t};\n\t},\n\n\tsupplier_filter: function (doc) {\n\t\tif (!doc.supplier) {\n\t\t\tfrappe.throw(\n\t\t\t\t__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))])\n\t\t\t);\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function (doc) {\n\t\tif (!doc.lead) {\n\t\t\tfrappe.throw(\n\t\t\t\t__(\"Please specify a {0}\", [__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))])\n\t\t\t);\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function () {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function () {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" };\n\t},\n\n\twarehouse: function (doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\", 0],\n\t\t\t],\n\t\t};\n\t},\n\n\tget_filtered_dimensions: function (doc, child_fields, dimension, company) {\n\t\tlet account = \"\";\n\n\t\tchild_fields.forEach((field) => {\n\t\t\tif (!account) {\n\t\t\t\taccount = doc[field];\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tquery: \"erpnext.controllers.queries.get_filtered_dimensions\",\n\t\t\tfilters: {\n\t\t\t\tdimension: dimension,\n\t\t\t\taccount: account,\n\t\t\t\tcompany: company,\n\t\t\t},\n\t\t};\n\t},\n});\n\nerpnext.queries.setup_queries = function (frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function (doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name, {\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: options,\n\t\t});\n\t\t$.each(link_fields, function (i, df) {\n\t\t\tif (parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(\n\t\tfrappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, { fieldtype: \"Table\" }),\n\t\tfunction (i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t}\n\t);\n};\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function (frm) {\n\tfrm.set_query(\"warehouse\", \"items\", function (doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif (row.item_code) {\n\t\t\t$.extend(filters, { query: \"erpnext.controllers.queries.warehouse_query\" });\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters;\n\t});\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function () {\n\t\tvar default_msg = {\n\t\t\tLead: \"\",\n\t\t\tOpportunity: \"Your enquiry has been logged into the system. Ref No: \" + doc.name,\n\t\t\tQuotation: \"Quotation \" + doc.name + \" has been sent via email. Thanks!\",\n\t\t\t\"Sales Order\":\n\t\t\t\t\"Sales Order \" +\n\t\t\t\tdoc.name +\n\t\t\t\t\" has been created against \" +\n\t\t\t\t(doc.quotation_no ? \"Quote No:\" + doc.quotation_no : \"\") +\n\t\t\t\t(doc.po_no ? \" for your PO: \" + doc.po_no : \"\"),\n\t\t\t\"Delivery Note\":\n\t\t\t\t\"Items has been delivered against delivery note: \" +\n\t\t\t\tdoc.name +\n\t\t\t\t(doc.po_no ? \" for your PO: \" + doc.po_no : \"\"),\n\t\t\t\"Sales Invoice\":\n\t\t\t\t\"Invoice \" +\n\t\t\t\tdoc.name +\n\t\t\t\t\" has been sent via email \" +\n\t\t\t\t(doc.po_no ? \" for your PO: \" + doc.po_no : \"\"),\n\t\t\t\"Material Request\": \"Material Request \" + doc.name + \" has been raised in the system\",\n\t\t\t\"Purchase Order\": \"Purchase Order \" + doc.name + \" has been sent via email\",\n\t\t\t\"Purchase Receipt\": \"Items has been received against purchase receipt: \" + doc.name,\n\t\t};\n\n\t\tif ([\"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(doc.doctype))\n\t\t\tthis.show(doc.contact_person, \"Customer\", doc.customer, \"\", default_msg[doc.doctype]);\n\t\telse if (doc.doctype === \"Quotation\")\n\t\t\tthis.show(doc.contact_person, \"Customer\", doc.party_name, \"\", default_msg[doc.doctype]);\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\"].includes(doc.doctype))\n\t\t\tthis.show(doc.contact_person, \"Supplier\", doc.supplier, \"\", default_msg[doc.doctype]);\n\t\telse if (doc.doctype == \"Lead\") this.show(\"\", \"\", \"\", doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == \"Opportunity\")\n\t\t\tthis.show(\"\", \"\", \"\", doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == \"Material Request\") this.show(\"\", \"\", \"\", \"\", default_msg[doc.doctype]);\n\t};\n\n\tthis.get_contact_number = function (contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tfrappe.msgprint(r.exc);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t},\n\t\t});\n\t};\n\n\tthis.show = function (contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact) {\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name);\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t};\n\tthis.show_dialog = function () {\n\t\tif (!me.dialog) me.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\tmessage: me.message,\n\t\t\tnumber: me.number,\n\t\t});\n\t\tme.dialog.show();\n\t};\n\tthis.make_dialog = function () {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: \"Send SMS\",\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{ fieldname: \"number\", fieldtype: \"Data\", label: \"Mobile Number\", reqd: 1 },\n\t\t\t\t{ fieldname: \"message\", fieldtype: \"Text\", label: \"Message\", reqd: 1 },\n\t\t\t\t{ fieldname: \"send\", fieldtype: \"Button\", label: \"Send\" },\n\t\t\t],\n\t\t});\n\t\td.fields_dict.send.input.onclick = function () {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif (v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif (r.exc) {\n\t\t\t\t\t\t\tfrappe.msgprint(r.exc);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis.dialog = d;\n\t};\n\tthis.setup();\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nconst SALES_DOCTYPES = [\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"];\nconst PURCHASE_DOCTYPES = [\"Supplier Quotation\", \"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"];\n\nerpnext.utils.get_party_details = function (frm, method, args, callback) {\n\tif (!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\n\tif (!args) {\n\t\tif (\n\t\t\t(frm.doctype != \"Purchase Order\" && frm.doc.customer) ||\n\t\t\t(frm.doc.party_name && [\"Quotation\", \"Opportunity\"].includes(frm.doc.doctype))\n\t\t) {\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && [\"Lead\", \"Prospect\"].includes(frm.doc.quotation_to)) {\n\t\t\t\tparty_type = frm.doc.quotation_to;\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list,\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list,\n\t\t\t};\n\t\t}\n\n\t\tif (!args) {\n\t\t\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: \"Customer\",\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!args || !args.party) return;\n\n\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\targs.fetch_payment_terms_template = cint(!frm.doc.ignore_default_payment_terms_template);\n\t}\n\n\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.company_address) {\n\t\t\targs.company_address = frm.doc.company_address;\n\t\t}\n\t}\n\n\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.billing_address) {\n\t\t\targs.company_address = frm.doc.billing_address;\n\t\t}\n\n\t\tif (!args.shipping_address && frm.doc.shipping_address) {\n\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t}\n\t}\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Posting / Transaction Date\",\n\t\t\t\targs.posting_date,\n\t\t\t\targs.party_type == \"Customer\" ? \"customer\" : \"supplier\"\n\t\t\t)\n\t\t)\n\t\t\treturn;\n\t}\n\n\tif (\n\t\t!erpnext.utils.validate_mandatory(\n\t\t\tfrm,\n\t\t\t\"Company\",\n\t\t\tfrm.doc.company,\n\t\t\targs.party_type == \"Customer\" ? \"customer\" : \"supplier\"\n\t\t)\n\t) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function (r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t},\n\t\t\t\t]);\n\t\t\t}\n\t\t},\n\t});\n};\n\nerpnext.utils.add_item = function (frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1] === \"Item\" && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child(\"items\");\n\t\t\tfrm.refresh_field(\"items\");\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, \"item_code\", prev_route[2]);\n\t\t}\n\t}\n};\n\nerpnext.utils.get_address_display = function (frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: { address_dict: frm.doc[address_field] },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value(display_field, \"\");\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function (\n\tfrm,\n\ttriggered_from_field,\n\tbilling_address_field,\n\tshipping_address_field\n) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Lead / Customer / Supplier\",\n\t\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Posting / Transaction Date\",\n\t\t\t\tfrm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\ttax_category: frm.doc.tax_category,\n\t\t\tbilling_address: frm.doc[billing_address_field],\n\t\t\tshipping_address: frm.doc[shipping_address_field],\n\t\t},\n\t\tcallback: function (r) {\n\t\t\tif (!r.exc) {\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n};\n\nerpnext.utils.set_taxes = function (frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Lead / Customer / Supplier\",\n\t\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!erpnext.utils.validate_mandatory(\n\t\t\t\tfrm,\n\t\t\t\t\"Posting / Transaction Date\",\n\t\t\t\tfrm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\ttriggered_from_field\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = \"Lead\";\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = \"Customer\";\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = \"Supplier\";\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to) {\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\tparty: party,\n\t\t\tparty_type: party_type,\n\t\t\tposting_date: frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\tcompany: frm.doc.company,\n\t\t\tcustomer_group: frm.doc.customer_group,\n\t\t\tsupplier_group: frm.doc.supplier_group,\n\t\t\ttax_category: frm.doc.tax_category,\n\t\t\tbilling_address:\n\t\t\t\tfrm.doc.customer || frm.doc.lead ? frm.doc.customer_address : frm.doc.supplier_address,\n\t\t\tshipping_address: frm.doc.shipping_address_name,\n\t\t},\n\t\tcallback: function (r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message);\n\t\t\t}\n\t\t},\n\t});\n};\n\nerpnext.utils.get_contact_details = function (frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: { contact: frm.doc.contact_person },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) frm.set_value(r.message);\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value({\n\t\t\tcontact_person: \"\",\n\t\t\tcontact_display: \"\",\n\t\t\tcontact_email: \"\",\n\t\t\tcontact_mobile: \"\",\n\t\t\tcontact_phone: \"\",\n\t\t\tcontact_designation: \"\",\n\t\t\tcontact_department: \"\",\n\t\t});\n\t}\n};\n\nerpnext.utils.validate_mandatory = function (frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({ message: __(\"Please enter {0} first\", [label]), title: __(\"Mandatory\") });\n\t\treturn false;\n\t}\n\treturn true;\n};\n\nerpnext.utils.get_shipping_address = function (frm, callback) {\n\tif (frm.doc.company) {\n\t\tif (\n\t\t\tfrm.doc.inter_company_order_reference ||\n\t\t\tfrm.doc.internal_invoice_reference ||\n\t\t\tfrm.doc.internal_order_reference\n\t\t) {\n\t\t\tif (callback) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t}\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.custom.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]); //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]); //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif (callback) {\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = class StockController extends frappe.ui.form.Controller {\n\tonload() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t}\n\n\tbarcode(doc, cdt, cdn)  {\n\t\tlet row = locals[cdt][cdn];\n\t\tif (row.barcode) {\n\t\t\terpnext.stock.utils.set_item_details_using_barcode(this.frm, row, (r) => {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, {\n\t\t\t\t\t\"item_code\": r.message.item_code,\n\t\t\t\t\t\"qty\": 1,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_warehouse_query() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t}\n\n\tsetup_posting_date_time_check() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_stock_ledger() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2,\n\t\t\t\t\tignore_prepared_report: true\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t}\n\n\tshow_general_ledger() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2,\n\t\t\t\t\tignore_prepared_report: true\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = class payments extends erpnext.stock.StockController {\n\tmake_payment() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: \"Payment\",\n\t\t});\n\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text();\n\t}\n\n\tselect_text() {\n\t\t$(this.$body)\n\t\t\t.find(\".form-control\")\n\t\t\t.click(function () {\n\t\t\t\t$(this).select();\n\t\t\t});\n\t}\n\n\tset_payment_primary_action() {\n\t\tvar me = this;\n\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function () {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tmake_keyboard() {\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template(\"pos_payment\", this.frm.doc));\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event();\n\t\tthis.clear_amount();\n\t}\n\n\tmake_multimode_payment() {\n\t\tvar me = this;\n\n\t\tif (this.frm.doc.change_amount > 0) {\n\t\t\tme.payment_val = me.doc.outstanding_amount;\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, \"Multi Mode Payment\", \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t}\n\n\tshow_payment_details() {\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find(\".multimode-payments\").empty();\n\t\tif (this.frm.doc.payments.length) {\n\t\t\t$.each(this.frm.doc.payments, function (index, data) {\n\t\t\t\t$(\n\t\t\t\t\tfrappe.render_template(\"payment_details\", {\n\t\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\t\tamount: data.amount,\n\t\t\t\t\t\tidx: data.idx,\n\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\ttype: data.type,\n\t\t\t\t\t})\n\t\t\t\t).appendTo(multimode_payments);\n\n\t\t\t\tif (data.type == \"Cash\" && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\", { idx: me.idx }));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments);\n\t\t}\n\t}\n\n\tset_outstanding_amount() {\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\", { idx: this.idx }));\n\t\tthis.highlight_selected_row();\n\t\tthis.payment_val = 0.0;\n\t\tif (this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0) {\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(\n\t\t\t\tthis.frm.doc.outstanding_amount / this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"outstanding_amount\")\n\t\t\t);\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount();\n\t\t} else if (flt(this.selected_mode.val()) > 0) {\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select();\n\t\tthis.bind_amount_change_event();\n\t}\n\n\tbind_keyboard_event() {\n\t\tvar me = this;\n\t\tthis.payment_val = \"\";\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t}\n\n\tbind_form_control_event() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".pos-payment-row\")\n\t\t\t.click(function () {\n\t\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\t\tme.set_outstanding_amount();\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".form-control\")\n\t\t\t.click(function () {\n\t\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\t\tme.set_outstanding_amount();\n\t\t\t\tme.update_paid_amount(true);\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".write_off_amount\")\n\t\t\t.change(function () {\n\t\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".change_amount\")\n\t\t\t.change(function () {\n\t\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t\t});\n\t}\n\n\thighlight_selected_row() {\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\", { idx: this.idx }));\n\t\t$(this.$body).find(\".pos-payment-row\").removeClass(\"selected-payment-mode\");\n\t\tselected_row.addClass(\"selected-payment-mode\");\n\t\t$(this.$body).find(\".amount\").attr(\"disabled\", true);\n\t\tthis.selected_mode.attr(\"disabled\", false);\n\t}\n\n\tbind_numeric_keys_event() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".pos-keyboard-key\")\n\t\t\t.click(function () {\n\t\t\t\tme.payment_val += $(this).text();\n\t\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\t\tme.update_paid_amount();\n\t\t\t});\n\n\t\t$(this.$body)\n\t\t\t.find(\".delete-btn\")\n\t\t\t.click(function () {\n\t\t\t\tme.payment_val = cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\t\tme.update_paid_amount();\n\t\t\t});\n\t}\n\n\tbind_amount_change_event() {\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function () {\n\t\t\tme.payment_val = flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_payment_amount();\n\t\t});\n\t}\n\n\tclear_amount() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".clr\")\n\t\t\t.click(function (e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\", { idx: me.idx }));\n\t\t\t\tme.payment_val = 0.0;\n\t\t\t\tme.selected_mode.val(0.0);\n\t\t\t\tme.highlight_selected_row();\n\t\t\t\tme.update_payment_amount();\n\t\t\t});\n\t}\n\n\twrite_off_amount(write_off_amount) {\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(\n\t\t\tthis.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\")\n\t\t);\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tchange_amount(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount();\n\t\tthis.show_amounts();\n\t}\n\n\tupdate_paid_amount(update_write_off) {\n\t\tvar me = this;\n\t\tif ([\"change_amount\", \"write_off_amount\"].includes(this.idx)) {\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif (me.idx == \"change_amount\") {\n\t\t\t\tme.change_amount(value);\n\t\t\t} else {\n\t\t\t\tif (flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(\n\t\t\t\t\t\tme.frm.doc.outstanding_amount / me.frm.doc.conversion_rate,\n\t\t\t\t\t\tprecision(me.idx)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.update_payment_amount();\n\t\t}\n\t}\n\n\tupdate_payment_amount() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function (index, data) {\n\t\t\tif (cint(me.idx) == cint(data.idx)) {\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2);\n\t\t\t}\n\t\t});\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t}\n\n\tshow_amounts() {\n\t\tvar me = this;\n\t\t$(this.$body)\n\t\t\t.find(\".write_off_amount\")\n\t\t\t.val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body)\n\t\t\t.find(\".paid_amount\")\n\t\t\t.text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body)\n\t\t\t.find(\".change_amount\")\n\t\t\t.val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency));\n\t\t$(this.$body)\n\t\t\t.find(\".outstanding_amount\")\n\t\t\t.text(\n\t\t\t\tformat_currency(\n\t\t\t\t\tthis.frm.doc.outstanding_amount,\n\t\t\t\t\tfrappe.get_doc(\":Company\", this.frm.doc.company).default_currency\n\t\t\t\t)\n\t\t\t);\n\t\tthis.update_invoice();\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = class TaxesAndTotals extends erpnext.payments {\n\tsetup() {\n\t\tthis.fetch_round_off_accounts();\n\t}\n\n\tapply_pricing_rule_on_item(item) {\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tlet item_rate = item.rate;\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif (item.margin_type == \"Percentage\") {\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif (item.discount_percentage && !item.discount_amount) {\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem_rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t\titem.discount_percentage = 100 * flt(item.discount_amount) / flt(item.rate_with_margin);\n\t\t}\n\n\t\tfrappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n\t}\n\n\tasync calculate_taxes_and_totals(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// # Update grand total as per cash and non trade discount\n\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\tthis.frm.doc.grand_total -= this.frm.doc.discount_amount;\n\t\t\tthis.frm.doc.base_grand_total -= this.frm.doc.base_discount_amount;\n\t\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\t\tthis.frm.doc.base_rounding_adjustment = 0;\n\t\t\tthis.set_rounded_total();\n\t\t}\n\n\t\tawait this.calculate_shipping_charges();\n\n\t\t// Advance calculation applicable to Sales/Purchase Invoice\n\t\tif (\n\t\t\t[\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2\n\t\t\t&& !this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (\n\t\t\t[\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.is_pos\n\t\t\t&& this.frm.doc.is_return\n\t\t) {\n\t\t\tthis.set_total_amount_to_default_mop();\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif (\n\t\t\tthis.frm.doc.doctype === \"Purchase Invoice\"\n\t\t\t&& this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)\n\t\t) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tcalculate_discount_amount() {\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t}\n\n\t_calculate_taxes_and_totals() {\n\t\tconst is_quotation = this.frm.doc.doctype == \"Quotation\";\n\t\tthis.frm._items = is_quotation ? this.filtered_items() : this.frm.doc.items;\n\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t}\n\n\tvalidate_conversion_rate() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst subs =  [conversion_rate_label, this.frm.doc.currency, company_currency];\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', subs);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_item_values() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\tfor (const item of this.frm._items || []) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\t\t\t\titem.qty = item.qty === undefined ? (me.frm.doc.is_return ? -1 : 1) : item.qty;\n\n\t\t\t\tif (!(me.frm.doc.is_return || me.frm.doc.is_debit_note)) {\n\t\t\t\t\titem.net_amount = item.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// allow for '0' qty on Credit/Debit notes\n\t\t\t\t\tlet qty = flt(item.qty);\n\t\t\t\t\tif (!qty) {\n\t\t\t\t\t\tqty = (me.frm.doc.is_debit_note ? 1 : -1);\n\t\t\t\t\t\tif (me.frm.doc.doctype !== \"Purchase Receipt\" && me.frm.doc.is_return === 1) {\n\t\t\t\t\t\t\t// In case of Purchase Receipt, qty can be 0 if all items are rejected\n\t\t\t\t\t\t\tqty = flt(item.qty);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\titem.net_amount = item.amount = flt(item.rate * qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t}\n\t}\n\n\tset_in_company_currency(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t}\n\n\tinitialize_taxes() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\ttax.item_wise_tax_detail = {};\n\t\t\t}\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t}\n\n\tfetch_round_off_accounts() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\treturn frappe.call({\n\t\t\t\t\"method\": \"erpnext.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tdetermine_exclusive_rate() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm._items || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t}\n\n\tget_current_tax_fraction(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t}\n\n\t_get_tax_rate(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t}\n\n\tcalculate_net_total() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm._items || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t});\n\t}\n\n\tcalculate_shipping_charges() {\n\t\t// Do not apply shipping rule for POS\n\t\tif (this.frm.doc.is_pos) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"shipping_rule\", this.frm.doc.name)) {\n\t\t\treturn this.shipping_rule();\n\t\t}\n\t}\n\n\tadd_taxes_from_item_tax_template(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif (item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif (typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif (!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_taxes() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm._items || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm._items.length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm._items.length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\tme.round_off_base_values(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tset_cumulative_total(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t}\n\n\t_load_item_tax_rate(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t}\n\n\tget_current_tax_amount(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tif (!tax.dont_recompute_tax) {\n\t\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\t\t}\n\n\t\treturn current_tax_amount;\n\t}\n\n\tset_item_wise_tax(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tif(typeof (tax_detail) == \"string\") {\n\t\t\ttax.item_wise_tax_detail = JSON.parse(tax.item_wise_tax_detail);\n\t\t\ttax_detail = tax.item_wise_tax_detail;\n\t\t}\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t}\n\n\tround_off_totals(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.tax_amount= Math.round(tax.tax_amount);\n\t\t\ttax.tax_amount_after_discount_amount = Math.round(tax.tax_amount_after_discount_amount);\n\t\t}\n\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t}\n\n\tround_off_base_values(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.base_tax_amount= Math.round(tax.base_tax_amount);\n\t\t\ttax.base_tax_amount_after_discount_amount = Math.round(tax.base_tax_amount_after_discount_amount);\n\t\t}\n\t}\n\n\tmanipulate_grand_total_for_inclusive_tax() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_totals() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif ([\"Valuation and Total\", \"Total\"].includes(tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t}\n\n\tset_rounded_total() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t}\n\n\t_cleanup() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\t\tlet items = this.frm._items;\n\n\t\tif(items && items.length) {\n\t\t\tif(!frappe.meta.get_docfield(items[0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(items || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_discount_amount() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t}\n\n\tapply_discount_amount() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm._items || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm._items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t}\n\n\tget_total_for_discount_amount() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif ([\"Actual\", \"On Item Quantity\"].includes(tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t}\n\n\tcalculate_total_advance(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = 0;\n\t\t}\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t\tthis.calculate_write_off_amount();\n\t}\n\n\tis_internal_invoice() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tcalculate_outstanding_amount(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif([\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif([\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t}\n\n\tset_total_amount_to_default_mop() {\n\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\tif (this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\tgrand_total - this.frm.doc.total_advance - this.frm.doc.write_off_amount,\n\t\t\t\tprecision(\"grand_total\")\n\t\t\t);\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(\n\t\t\t\t\tflt(\n\t\t\t\t\t\tbase_grand_total,\n\t\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t\t)\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount\n\t\t\t\t),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\n\t\tif(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments.find(payment => {\n\t\t\t\tif (payment.default) {\n\t\t\t\t\tpayment.amount = total_amount_to_pay;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tset_default_payment(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount, amount;\n\n\t\t\t\t\tif (me.frm.doc.party_account_currency == me.frm.doc.currency) {\n\t\t\t\t\t\t// if customer/supplier currency is same as company currency\n\t\t\t\t\t\t// total_amount_to_pay is already in customer/supplier currency\n\t\t\t\t\t\t// so base_amount has to be calculated using total_amount_to_pay\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay, precision(\"amount\", data));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculate_paid_amount() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t}\n\n\tcalculate_change_amount(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif([\"Sales Invoice\", \"POS Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total,\n\t\t\t\t\tprecision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total, precision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tcalculate_write_off_amount() {\n\t\tif(this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.outstanding_amount, precision(\"write_off_amount\"));\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\n\t\t\tthis.calculate_outstanding_amount(false);\n\t\t}\n\n\t}\n\n\tfiltered_items() {\n\t\treturn this.frm.doc.items.filter(item => !item[\"is_alternative\"]);\n\t}\n};\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n\nerpnext.TransactionController = class TransactionController extends erpnext.taxes_and_totals {\n\tsetup() {\n\t\tsuper.setup();\n\t\tlet me = this;\n\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\tcur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif (!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.target_warehouse && frm.doc.set_target_warehouse) {\n\t\t\t\t\titem.target_warehouse = frm.doc.set_target_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.from_warehouse && frm.doc.set_from_warehouse) {\n\t\t\t\t\titem.from_warehouse = frm.doc.set_from_warehouse;\n\t\t\t\t}\n\n\t\t\t\terpnext.accounts.dimensions.copy_dimension_from_first_row(frm, cdt, cdn, 'items');\n\t\t\t}\n\t\t});\n\n\t\tif(this.frm.fields_dict['items'].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query('batch_no', 'items', function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.process_item_removal;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"expense_account\")) {\n\t\t\tthis.frm.set_query(\"expense_account\", \"items\", function(doc) {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"report_type\": \"Profit and Loss\",\n\t\t\t\t\t\t\"is_group\": 0\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\n\t\t\t});\n\t\t}\n\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field('blanket_order')) {\n\t\t\tthis.frm.set_query(\"blanket_order\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tvar item = locals[cdt][cdn];\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_blanket_orders\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"blanket_order_type\": doc.doctype === \"Sales Order\" ? \"Selling\" : \"Purchasing\",\n\t\t\t\t\t\t\"item\": item.item_code\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict.taxes_and_charges) {\n\t\t\tthis.frm.set_query(\"taxes_and_charges\", function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['company', '=', me.frm.doc.company],\n\t\t\t\t\t\t['docstatus', '!=', 2]\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t}\n\tonload() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.frm.trigger('set_default_internal_warehouse');\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 0),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t\tif(this.frm.fields_dict['items'].grid.get_field('batch_no')) {\n\t\t\tlet batch_field = this.frm.get_docfield('items', 'batch_no');\n\t\t\tif (batch_field) {\n\t\t\t\tbatch_field.get_route_options_for_new_doc = (row) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'item': row.doc.item_code\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tis_return() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t}\n\n\tsetup_quality_inspection() {\n\t\tif(![\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst me = this;\n\t\tif (\n\t\t\t!this.frm.is_new()\n\t\t\t&& this.frm.doc.docstatus === 0\n\t\t\t&& frappe.model.can_create(\"Quality Inspection\")\n\t\t) {\n\t\t\tthis.frm.add_custom_button(__(\"Quality Inspection(s)\"), () => {\n\t\t\t\tme.make_quality_inspection();\n\t\t\t}, __(\"Create\"));\n\t\t\tthis.frm.page.set_inner_btn_group_as_primary(__('Create'));\n\t\t}\n\n\t\tconst inspection_type = [\"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tlet quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_payment_request() {\n\t\tlet me = this;\n\t\tconst payment_request_type = (['Sales Order', 'Sales Invoice'].includes(this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tonload_post_render() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !this.frm.doc.__onload?.load_after_mapping) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\n\t\t}\n\t}\n\n\trefresh() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t\tthis.validate_has_items();\n\t}\n\n\tscan_barcode() {\n\t\tconst barcode_scanner = new erpnext.utils.BarcodeScanner({frm:this.frm});\n\t\tbarcode_scanner.process_scan();\n\t}\n\n\tbarcode(doc, cdt, cdn)  {\n\t\tlet row = locals[cdt][cdn];\n\t\tif (row.barcode) {\n\t\t\terpnext.stock.utils.set_item_details_using_barcode(this.frm, row, (r) => {\n\t\t\t\tdebugger\n\t\t\t\tfrappe.model.set_value(cdt, cdn, {\n\t\t\t\t\t\"item_code\": r.message.item_code,\n\t\t\t\t\t\"qty\": 1,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tvalidate_has_items () {\n\t\tlet table = this.frm.doc.items;\n\t\tthis.frm.has_items = (table && table.length\n\t\t\t&& table[0].qty && table[0].item_code);\n\t}\n\n\tapply_default_taxes() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges || \"\",\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tdebounce: 2000,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_sms() {\n\t\tvar me = this;\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\n\t\tif(this.frm.doc.docstatus===1 && ![\"Lost\", \"Stopped\", \"Closed\"].includes(this.frm.doc.status)\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t}\n\n\tsend_sms() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t}\n\n\titem_code(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\n\t\titem.weight_per_unit = 0;\n\t\titem.weight_uom = '';\n\t\titem.conversion_factor = 0;\n\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\t\titem.barcode = null;\n\n\n\t\tif(item.item_code || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\titem.pricing_rules = ''\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tbatch_no: item.batch_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_return: cint(me.frm.doc.is_return),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tnet_rate: item.rate,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tuom: item.uom,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center,\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\t\t\tchild_doctype: item.doctype,\n\t\t\t\t\t\t\tchild_docname: item.name,\n\t\t\t\t\t\t\tis_old_subcontracting_flow: me.frm.doc.is_old_subcontracting_flow,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\n\t\t\t\t\t\t\t\t\tif (d.free_item_data && d.free_item_data.length > 0) {\n\t\t\t\t\t\t\t\t\t\tme.apply_product_discount(d);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// for internal customer instead of pricing rule directly apply valuation rate on item\n\t\t\t\t\t\t\t\t\tif ((me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) && me.frm.doc.represents_company === me.frm.doc.company) {\n\t\t\t\t\t\t\t\t\t\tme.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\n\t\t\t\t\t\t\t\t\t\t\tme.frm.doc.doctype, me.frm.doc.company);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (r.message &&\n\t\t\t\t\t\t\t\t\t\t\t\t(r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// check if batch serial selector is disabled or not\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog && !frappe.flags.hide_serial_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_single_value('Stock Settings', 'disable_serial_no_and_batch_selector')\n\t\t\t\t\t\t\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (d.has_batch_no && d.has_serial_no) {\n\t\t\t\t\t\t\t\t\t\t\td.batch_no = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tif (!me.frm.doc.set_warehouse)\n\t\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('warehouse', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tme.apply_price_list(item, true);\n\t\t\t\t\t\t\t\t\t\t}, undefined, !frappe.flags.hide_serial_batch_dialog);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t\t\t\t\t() => me.remove_pricing_rule(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (item.apply_rule_on_other_items) {\n\t\t\t\t\t\t\t\t\t\tlet key = item.name;\n\t\t\t\t\t\t\t\t\t\tme.apply_rule_on_other_items({key: item});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\t\t\t\t\t\tme.update_item_grid_labels(company_currency);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprice_list_rate(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tfrappe.model.round_floats_in(item, [\"price_list_rate\", \"discount_percentage\"]);\n\n\t\t// check if child doctype is Sales Order Item/Quotation Item and calculate the rate\n\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\", \"POS Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), cdt)\n\t\t\tthis.apply_pricing_rule_on_item(item);\n\t\telse\n\t\t\titem.rate = flt(item.price_list_rate * (1 - item.discount_percentage / 100.0),\n\t\t\t\tprecision(\"rate\", item));\n\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tmargin_rate_or_amount(doc, cdt, cdn) {\n\t\t// calculated the revised total margin and rate on margin rate changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tthis.apply_pricing_rule_on_item(item);\n\t\tthis.calculate_taxes_and_totals();\n\t\tcur_frm.refresh_fields();\n\t}\n\n\tmargin_type(doc, cdt, cdn) {\n\t\t// calculate the revised total margin and rate on margin type changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!item.margin_type) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"margin_rate_or_amount\", 0);\n\t\t} else {\n\t\t\tthis.apply_pricing_rule_on_item(item, doc, cdt, cdn);\n\t\t\tthis.calculate_taxes_and_totals();\n\t\t\tcur_frm.refresh_fields();\n\t\t}\n\t}\n\n\tget_incoming_rate(item, posting_date, posting_time, voucher_type, company) {\n\n\t\tlet item_args = {\n\t\t\t'item_code': item.item_code,\n\t\t\t'warehouse': in_list('Purchase Receipt', 'Purchase Invoice') ? item.from_warehouse : item.warehouse,\n\t\t\t'posting_date': posting_date,\n\t\t\t'posting_time': posting_time,\n\t\t\t'qty': item.qty * item.conversion_factor,\n\t\t\t'serial_no': item.serial_no,\n\t\t\t'batch_no': item.batch_no,\n\t\t\t'voucher_type': voucher_type,\n\t\t\t'company': company,\n\t\t\t'allow_zero_valuation_rate': item.allow_zero_valuation_rate\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.utils.get_incoming_rate',\n\t\t\targs: {\n\t\t\t\targs: item_args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.model.set_value(item.doctype, item.name, 'rate', r.message * item.conversion_factor);\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_taxes_from_item_tax_template(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif(item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif(typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif(!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tserial_no(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.doctype === 'Purchase Receipt Item Supplied') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Replace all occurences of comma with line feed\n\t\t\t\titem.serial_no = item.serial_no.replace(/,/g, '\\n');\n\t\t\t\titem.conversion_factor = item.conversion_factor || 1;\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif (!doc.is_return && cint(frappe.user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tme.update_qty(cdt, cdn);\n\t\t\t\t\t}, 10000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdate_qty(cdt, cdn) {\n\t\tvar valid_serial_nos = [];\n\t\tvar serialnos = [];\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tserialnos = item.serial_no.split(\"\\n\");\n\t\tfor (var i = 0; i < serialnos.length; i++) {\n\t\t\tif (serialnos[i] != \"\") {\n\t\t\t\tvalid_serial_nos.push(serialnos[i]);\n\t\t\t}\n\t\t}\n\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t}\n\n\tvalidate() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t}\n\n\tupdate_stock() {\n\t\tthis.frm.trigger('set_default_internal_warehouse');\n\t}\n\n\tset_default_internal_warehouse() {\n\t\tlet me = this;\n\t\tif ((this.frm.doc.doctype === 'Sales Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Delivery Note') {\n\t\t\tif (this.frm.doc.is_internal_customer && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_target_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif ((this.frm.doc.doctype === 'Purchase Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Purchase Receipt') {\n\t\t\tif (this.frm.doc.is_internal_supplier && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_from_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tcompany() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc && company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet selling_doctypes_for_tc = [\"Sales Invoice\", \"Quotation\", \"Sales Order\", \"Delivery Note\"];\n\t\t\t\tif (company_doc.default_selling_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tselling_doctypes_for_tc.includes(me.frm.doc.doctype) && !me.frm.doc.tc_name) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_selling_terms);\n\t\t\t\t}\n\t\t\t\tlet buying_doctypes_for_tc = [\"Request for Quotation\", \"Supplier Quotation\", \"Purchase Order\",\n\t\t\t\t\t\"Material Request\", \"Purchase Receipt\"];\n\t\t\t\t// Purchase Invoice is excluded as per issue #3345\n\t\t\t\tif (company_doc.default_buying_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tbuying_doctypes_for_tc.includes(me.frm.doc.doctype) && !me.frm.doc.tc_name) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_buying_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.update_item_tax_map(),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif ([\"Sales Invoice\", \"Purchase Invoice\"].includes(me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\t['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'].includes(this.frm.doctype)) {\n\t\t\terpnext.utils.get_shipping_address(this.frm, function() {\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t});\n\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t}\n\n\ttransaction_date() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t}\n\n\tposting_date() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t}\n\n\tdue_date() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = __(\"Please clear the\") + \" \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = __(\"selected Payment Terms Template\");\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = __(\"Payment Schedule Table\");\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t}\n\n\tbill_date() {\n\t\tthis.posting_date();\n\t}\n\n\trecalculate_terms() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tget_company_currency() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t}\n\n\tcontact_person() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t}\n\n\tcurrency() {\n\t\t// The transaction date be either transaction_date (from orders) or posting_date (from invoices)\n\t\tlet transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\n\t\tlet me = this;\n\t\tthis.set_dynamic_labels();\n\t\tlet company_currency = this.get_company_currency();\n\t\t// Added `load_after_mapping` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !this.frm.doc.__onload?.load_after_mapping) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\t// company currency and doc currency is same\n\t\t\t// this will prevent unnecessary conversion rate triggers\n\t\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t} else {\n\t\t\t\tthis.conversion_rate();\n\t\t\t}\n\t\t}\n\t}\n\n\tconversion_rate() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.__onload?.load_after_mapping) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t}\n\n\tapply_discount_on_item(doc, cdt, cdn, field) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.price_list_rate) {\n\t\t\titem[field] = 0.0;\n\t\t} else {\n\t\t\tthis.price_list_rate(doc, cdt, cdn);\n\t\t}\n\t\tthis.set_gross_profit(item);\n\t}\n\n\tshipping_rule() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme._calculate_taxes_and_totals();\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t}\n\n\tset_margin_amount_based_on_currency(exchange_rate) {\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"Purchase Invoice\", \"Purchase Order\", \"Purchase Receipt\"]), this.frm.doc.doctype) {\n\t\t\tvar me = this;\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\n\t\t\t\tif(d.margin_type == \"Amount\") {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tset_actual_charges_based_on_currency(exchange_rate) {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.base_tax_amount) / flt(exchange_rate));\n\t\t\t}\n\t\t});\n\t}\n\n\tget_exchange_rate(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Fetching exchange rates ...\"),\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t}\n\n\tprice_list_currency() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `load_after_mapping` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  &&\n\t\t\t\t!this.frm.doc.__onload?.load_after_mapping) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t}\n\n\tplc_conversion_rate() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t}\n\n\tuom(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\titem.pricing_rules = ''\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'conversion_factor', r.message.conversion_factor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.calculate_stock_uom_rate(doc, cdt, cdn);\n\t}\n\n\tconversion_factor(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\n\t\t\tif(doc.doctype != \"Material Request\") {\n\t\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\t\tthis.calculate_net_weight();\n\t\t\t}\n\n\t\t\t// for handling customization not to fetch price list rate\n\t\t\tif(frappe.flags.dont_fetch_price_list_rate) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\n\t\t}\n\t}\n\n\tis_a_mapped_document(item) {\n\t\tconst mapped_item_field_map = {\n\t\t\t\"Delivery Note Item\": [\"si_detail\", \"so_detail\", \"dn_detail\"],\n\t\t\t\"Sales Invoice Item\": [\"dn_detail\", \"so_detail\", \"sales_invoice_item\"],\n\t\t\t\"Purchase Receipt Item\": [\"purchase_order_item\", \"purchase_invoice_item\", \"purchase_receipt_item\"],\n\t\t\t\"Purchase Invoice Item\": [\"purchase_order_item\", \"pr_detail\", \"po_detail\"],\n\t\t};\n\t\tconst mappped_fields = mapped_item_field_map[item.doctype] || [];\n\n\t\treturn mappped_fields\n\t\t\t.map((field) => item[field])\n\t\t\t.filter(Boolean).length > 0;\n\t}\n\n\tbatch_no(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!this.is_a_mapped_document(item)) {\n\t\t\tthis.apply_price_list(item, true);\n\t\t}\n\t}\n\n\ttoggle_conversion_factor(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t}\n\n\tqty(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\t// item.pricing_rules = ''\n\t\tfrappe.run_serially([\n\t\t\t() => this.remove_pricing_rule(item),\n\t\t\t() => this.conversion_factor(doc, cdt, cdn, true),\n\t\t\t() => this.calculate_stock_uom_rate(doc, cdt, cdn),\n\t\t\t() => this.apply_pricing_rule(item, true)\n\t\t]);\n\t}\n\n\tcalculate_stock_uom_rate(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\titem.stock_uom_rate = flt(item.rate)/flt(item.conversion_factor);\n\t\trefresh_field(\"stock_uom_rate\", item.name, item.parentfield);\n\t}\n\tservice_stop_date(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t}\n\n\tservice_start_date(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {\"args\": child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tprocess_item_removal() {\n\t\tthis.frm.trigger(\"calculate_taxes_and_totals\");\n\t\tthis.frm.trigger(\"calculate_net_weight\");\n\t}\n\n\tcalculate_net_weight(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t}\n\n\tset_dynamic_labels() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t}\n\n\tchange_form_labels(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\"tax_withholding_net_total\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\", \"base_tax_withholding_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t}\n\n\tchange_grid_labels(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.update_item_grid_labels(company_currency);\n\n\t\tthis.toggle_item_grid_columns(company_currency);\n\n\t\tif (this.frm.doc.operations && this.frm.doc.operations.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.scrap_items && this.frm.doc.scrap_items.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif (this.frm.doc.advances && this.frm.doc.advances.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\tthis.update_payment_schedule_grid_labels(company_currency);\n\t}\n\n\tupdate_item_grid_labels(company_currency) {\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"base_rate\", \"base_net_rate\", \"base_price_list_rate\",\n\t\t\t\"base_amount\", \"base_net_amount\", \"base_rate_with_margin\"\n\t\t], company_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"rate\", \"net_rate\", \"price_list_rate\", \"amount\",\n\t\t\t\"net_amount\", \"stock_uom_rate\", \"rate_with_margin\"\n\t\t], this.frm.doc.currency, \"items\");\n\t}\n\n\tupdate_payment_schedule_grid_labels(company_currency) {\n\t\tconst me = this;\n\t\tif (this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"],\n\t\t\t\tcompany_currency, \"payment_schedule\");\n\t\t\tthis.frm.set_currency_labels([\"payment_amount\", \"outstanding\", \"paid_amount\"],\n\t\t\t\tthis.frm.doc.currency, \"payment_schedule\");\n\n\t\t\tvar schedule_grid = this.frm.fields_dict[\"payment_schedule\"].grid;\n\t\t\t$.each([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"], function(i, fname) {\n\t\t\t\tif (frappe.meta.get_docfield(schedule_grid.doctype, fname))\n\t\t\t\t\tschedule_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\t}\n\n\ttoggle_item_grid_columns(company_currency) {\n\t\tconst me = this;\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\", \"base_rate_with_margin\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\t}\n\n\trecalculate() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\trecalculate_values() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tcalculate_charges() {\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tignore_pricing_rule() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code) {\n\t\t\t\t\tif (d.is_free_item) {\n\t\t\t\t\t\t// Simply remove free items\n\t\t\t\t\t\tme.frm.get_field(\"items\").grid.grid_rows[i].remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\t\t\"price_list_rate\": d.price_list_rate\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tr.message.forEach(row_item => {\n\t\t\t\t\t\t\tme.remove_pricing_rule(row_item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t}\n\n\tapply_pricing_rule(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\t// Target doc created from a mapped doc\n\t\tif (this.frm.doc.__onload?.load_after_mapping) {\n\t\t\t// Calculate totals even though pricing rule is not applied.\n\t\t\t// `apply_pricing_rule` is triggered due to change in data which most likely contributes to Total.\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif (me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t_get_args(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": ['Sales Invoice', 'Purchase Invoice'].includes(me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\"coupon_code\": me.frm.doc.coupon_code\n\t\t};\n\t}\n\n\t_get_item_list(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"child_docname\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\"is_free_item\": d.is_free_item,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"batch_no\": d.batch_no,\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\",  \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), d.doctype) {\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t}\n\n\t_set_values_for_item_list(children) {\n\t\tconst items_rule_dict = {};\n\n\t\tfor (const child of children) {\n\t\t\tconst existing_pricing_rule = frappe.model.get_value(child.doctype, child.name, \"pricing_rules\");\n\n\t\t\tfor (const [key, value] of Object.entries(child)) {\n\t\t\t\tif (![\"doctype\", \"name\"].includes(key)) {\n\t\t\t\t\tif (key === \"price_list_rate\") {\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, \"rate\", value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === \"pricing_rules\") {\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, key, value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key !== \"free_item_data\") {\n\t\t\t\t\t\tif (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n\t\t\t\t\t\t\tif (!in_list(JSON.parse(child.apply_rule_on_other_items), child.item_code)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfrappe.model.set_value(child.doctype, child.name, key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(\n\t\t\t\tfrappe.get_doc(child.doctype, child.name),\n\t\t\t\t[\"price_list_rate\", \"discount_percentage\"],\n\t\t\t);\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif (!this.frm.doc.ignore_pricing_rule && existing_pricing_rule && !child.pricing_rules) {\n\t\t\t\tthis.apply_price_list(frappe.get_doc(child.doctype, child.name));\n\t\t\t} else if (!child.pricing_rules) {\n\t\t\t\tthis.remove_pricing_rule(frappe.get_doc(child.doctype, child.name));\n\t\t\t}\n\n\t\t\tif (child.free_item_data && child.free_item_data.length > 0) {\n\t\t\t\tthis.apply_product_discount(child);\n\t\t\t}\n\n\t\t\tif (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n\t\t\t\titems_rule_dict[child.name] = child;\n\t\t\t}\n\t\t}\n\n\t\tthis.apply_rule_on_other_items(items_rule_dict);\n\t\tthis.calculate_taxes_and_totals();\n\t}\n\n\tapply_rule_on_other_items(args) {\n\t\tconst me = this;\n\t\tconst fields = [\"discount_percentage\", \"pricing_rules\", \"discount_amount\", \"rate\"];\n\n\t\tfor(var k in args) {\n\t\t\tlet data = args[k];\n\n\t\t\tif (data && data.apply_rule_on_other_items && JSON.parse(data.apply_rule_on_other_items)) {\n\t\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\t\tif (in_list(JSON.parse(data.apply_rule_on_other_items), d[data.apply_rule_on])) {\n\t\t\t\t\t\tfor(var k in data) {\n\t\t\t\t\t\t\tif (in_list(fields, k) && data[k] && (data.price_or_product_discount === 'Price' || k === 'pricing_rules')) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, data[k]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tapply_product_discount(args) {\n\t\tconst items = this.frm.doc.items.filter(d => (d.is_free_item)) || [];\n\n\t\tconst exist_items = items.map(row => { return {item_code: row.item_code, pricing_rules: row.pricing_rules};});\n\n\t\targs.free_item_data.forEach(pr_row => {\n\t\t\tlet row_to_modify = {};\n\n\t\t\t// If there are no free items, or if the current free item doesn't exist in the table, add it\n\t\t\tif (!items || !exist_items.filter(e_row => {\n\t\t\t\treturn e_row.item_code == pr_row.item_code && e_row.pricing_rules == pr_row.pricing_rules;\n\t\t\t}).length) {\n\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc,\n\t\t\t\t\tthis.frm.doc.doctype + ' Item', 'items');\n\n\t\t\t} else if(items) {\n\t\t\t\trow_to_modify = items.filter(d => (d.item_code === pr_row.item_code\n\t\t\t\t\t&& d.pricing_rules === pr_row.pricing_rules))[0];\n\t\t\t}\n\n\t\t\tfor (let key in pr_row) {\n\t\t\t\trow_to_modify[key] = pr_row[key];\n\t\t\t}\n\t\t\tthis.frm.script_manager.copy_from_first_row(\"items\", row_to_modify, [\"expense_account\", \"income_account\"]);\n\t\t});\n\n\t\t// free_item_data is a temporary variable\n\t\targs.free_item_data = '';\n\t\trefresh_field('items');\n\t}\n\n\tapply_price_list(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\n\n\t\tif (this.frm.doc.doctype === \"Material Request\") {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t\t$.each(r.message.children || [], function(i, d) {\n\t\t\t\t\t\t\t\t\tme.apply_discount_on_item(d, d.doctype, d.name, 'discount_percentage');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t}\n\n\tremove_pricing_rule(item) {\n\t\tlet me = this;\n\t\tconst fields = [\"discount_percentage\",\n\t\t\t\"discount_amount\", \"margin_rate_or_amount\", \"rate_with_margin\"];\n\n\t\tif(item.remove_free_item) {\n\t\t\tvar items = [];\n\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\tif(d.item_code != item.remove_free_item || !d.is_free_item) {\n\t\t\t\t\titems.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.frm.doc.items = items;\n\t\t\trefresh_field('items');\n\t\t} else if(item.applied_on_items && item.apply_on) {\n\t\t\tconst applied_on_items = item.applied_on_items.split(',');\n\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\tif(applied_on_items.includes(row[item.apply_on])) {\n\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\trow[f] = 0;\n\t\t\t\t\t});\n\n\t\t\t\t\t[\"pricing_rules\", \"margin_type\"].forEach(field => {\n\t\t\t\t\t\tif (row[field]) {\n\t\t\t\t\t\t\trow[field] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.trigger_price_list_rate();\n\t\t}\n\t}\n\n\ttrigger_price_list_rate() {\n\t\tvar me  = this;\n\n\t\tthis.frm.doc.items.forEach(child_row => {\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\n\t\t\t\tchild_row.doctype, child_row.name);\n\t\t})\n\t}\n\n\tvalidate_company_and_party() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\tif (frappe.flags.ignore_company_party_validation) {\n\t\t\treturn valid;\n\t\t}\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && ![\"Purchase Order\",\"Purchase Invoice\"].includes(me.frm.doc.doctype)) {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t}\n\n\tget_terms() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t}\n\n\ttaxes_and_charges() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\ttax_category() {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.update_item_tax_map(),\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\n\t\t]);\n\t}\n\n\tupdate_item_tax_map() {\n\t\tlet me = this;\n\t\tlet item_codes = [];\n\t\tlet item_rates = {};\n\t\tlet item_tax_templates = {};\n\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\tif (item.item_code) {\n\t\t\t\t// Use combination of name and item code in case same item is added multiple times\n\t\t\t\titem_codes.push([item.item_code, item.name]);\n\t\t\t\titem_rates[item.name] = item.net_rate;\n\t\t\t\titem_tax_templates[item.name] = item.item_tax_template;\n\t\t\t}\n\t\t});\n\n\t\tif (item_codes.length) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\n\t\t\t\t\titem_codes: item_codes,\n\t\t\t\t\titem_rates: item_rates,\n\t\t\t\t\titem_tax_templates: item_tax_templates\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\n\t\t\t\t\t\t\tif (item.name && r.message.hasOwnProperty(item.name) && r.message[item.name].item_tax_template) {\n\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.name].item_tax_template;\n\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.name].item_tax_rate;\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\titem_tax_template(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t}\n\n\n\tis_recurring() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t}\n\n\tfrom_date() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t}\n\n\tset_gross_profit(item) {\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(this.frm.doc.doctype) && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t}\n\n\tsetup_item_selector() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t}\n\n\tget_advances() {\n\t\tif(!this.frm.is_return) {\n\t\t\tvar me = this;\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t\tme.frm.dirty();\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tmake_payment_entry() {\n\t\tlet via_journal_entry = this.frm.doc.__onload && this.frm.doc.__onload.make_payment_via_journal_entry;\n\t\tif(this.has_discount_in_schedule() && !via_journal_entry) {\n\t\t\t// If early payment discount is applied, ask user for reference date\n\t\t\tthis.prompt_user_for_reference_date();\n\t\t} else {\n\t\t\tthis.make_mapped_payment_entry();\n\t\t}\n\t}\n\n\tmake_mapped_payment_entry(args) {\n\t\tvar me = this;\n\t\targs = args || { \"dt\": this.frm.doc.doctype, \"dn\": this.frm.doc.name };\n\t\treturn frappe.call({\n\t\t\tmethod: me.get_method_for_payment(),\n\t\t\targs: args,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t});\n\t}\n\n\tprompt_user_for_reference_date(){\n\t\tlet me = this;\n\t\tfrappe.prompt({\n\t\t\tlabel: __(\"Cheque/Reference Date\"),\n\t\t\tfieldname: \"reference_date\",\n\t\t\tfieldtype: \"Date\",\n\t\t\treqd: 1,\n\t\t}, (values) => {\n\t\t\tlet args = {\n\t\t\t\t\"dt\": me.frm.doc.doctype,\n\t\t\t\t\"dn\": me.frm.doc.name,\n\t\t\t\t\"reference_date\": values.reference_date\n\t\t\t}\n\t\t\tme.make_mapped_payment_entry(args);\n\t\t},\n\t\t__(\"Reference Date for Early Payment Discount\"),\n\t\t__(\"Continue\")\n\t\t);\n\t}\n\n\thas_discount_in_schedule() {\n\t\tlet is_eligible = in_list(\n\t\t\t[\"Sales Order\", \"Sales Invoice\", \"Purchase Order\", \"Purchase Invoice\"],\n\t\t\tthis.frm.doctype\n\t\t);\n\t\tlet has_payment_schedule = this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length;\n\t\tif(!is_eligible || !has_payment_schedule) return false;\n\n\t\tlet has_discount = this.frm.doc.payment_schedule.some(row => row.discount);\n\t\treturn has_discount;\n\t}\n\n\tmake_quality_inspection() {\n\t\tlet data = [];\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"items\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_name\",\n\t\t\t\t\t\tlabel: __(\"Item Name\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\tlabel: __(\"Accepted Quantity\"),\n\t\t\t\t\t\tin_list_view: true,\n\t\t\t\t\t\tread_only: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"sample_size\",\n\t\t\t\t\t\tlabel: __(\"Sample Size\"),\n\t\t\t\t\t\treqd: true,\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"description\",\n\t\t\t\t\t\tlabel: __(\"Description\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\t\t\tlabel: __(\"Serial No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\n\t\tconst me = this;\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select Items for Quality Inspection\"),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function () {\n\t\t\t\tconst data = dialog.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.make_quality_inspections\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\tdocname: me.frm.doc.name,\n\t\t\t\t\t\titems: data.items\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message.length > 0) {\n\t\t\t\t\t\t\tif (r.message.length === 1) {\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Quality Inspection\", r.message[0]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\t\t\t\t\t\"reference_name\": me.frm.doc.name\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrappe.set_route(\"List\", \"Quality Inspection\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Create\")\n\t\t});\n\n\t\tthis.frm.doc.items.forEach(item => {\n\t\t\tif (this.has_inspection_required(item)) {\n\t\t\t\tlet dialog_items = dialog.fields_dict.items;\n\t\t\t\tdialog_items.df.data.push({\n\t\t\t\t\t\"docname\": item.name,\n\t\t\t\t\t\"item_code\": item.item_code,\n\t\t\t\t\t\"item_name\": item.item_name,\n\t\t\t\t\t\"qty\": item.qty,\n\t\t\t\t\t\"description\": item.description,\n\t\t\t\t\t\"serial_no\": item.serial_no,\n\t\t\t\t\t\"batch_no\": item.batch_no,\n\t\t\t\t\t\"sample_size\": item.sample_quantity\n\t\t\t\t});\n\t\t\t\tdialog_items.grid.refresh();\n\t\t\t}\n\t\t});\n\n\t\tdata = dialog.fields_dict.items.df.data;\n\t\tif (!data.length) {\n\t\t\tfrappe.msgprint(__(\"All items in this document already have a linked Quality Inspection.\"));\n\t\t} else {\n\t\t\tdialog.show();\n\t\t}\n\t}\n\n\thas_inspection_required(item) {\n\t\tif (this.frm.doc.doctype === \"Stock Entry\" && this.frm.doc.purpose == \"Manufacture\" ) {\n\t\t\tif (item.is_finished_item && !item.quality_inspection) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (!item.quality_inspection) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tget_method_for_payment() {\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(['Sales Invoice', 'Purchase Invoice'].includes( cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t}\n\n\tset_query_for_batch(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\n\t\t\tif (doc.is_return) {\n\t\t\t\tfilters[\"is_return\"] = 1;\n\t\t\t}\n\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t}\n\n\tset_query_for_item_tax_template(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.item_code) {\n\t\t\treturn doc.company ? {filters: {company: doc.company}} : {};\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\n\t\t\t\t'item_group': item.item_group,\n\t\t\t}\n\n\t\t\tif (doc.tax_category)\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\n\t\t\tif (doc.company)\n\t\t\t\tfilters['company'] = doc.company;\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t}\n\n\tpayment_terms_template() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbase_grand_total: doc.base_rounded_total || doc.base_grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tpayment_term(doc, cdt, cdn) {\n\t\tconst me = this;\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total,\n\t\t\t\t\tbase_grand_total: this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tagainst_blanket_order(doc, cdt, cdn) {\n\t\tvar item = locals[cdt][cdn];\n\t\tif(!item.against_blanket_order) {\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order\", null);\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order_rate\", 0.00);\n\t\t}\n\t}\n\n\tblanket_order(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\targs:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tset_reserve_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.supplied_items, \"reserve_warehouse\", this.frm.doc.set_reserve_warehouse);\n\t}\n\n\tset_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"warehouse\", this.frm.doc.set_warehouse);\n\t}\n\n\tset_target_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"target_warehouse\", this.frm.doc.set_target_warehouse);\n\t}\n\n\tset_from_warehouse() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"from_warehouse\", this.frm.doc.set_from_warehouse);\n\t}\n\n\tautofill_warehouse(child_table, warehouse_field, warehouse) {\n\t\tif (warehouse && child_table && child_table.length) {\n\t\t\tlet doctype = child_table[0].doctype;\n\t\t\t$.each(child_table || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\n\t\t\t});\n\t\t}\n\t}\n\n\tcoupon_code() {\n\t\tif (this.frm.doc.coupon_code || this.frm._last_coupon_code) {\n\t\t\t// reset pricing rules if coupon code is set or is unset\n\t\t\tconst _ignore_pricing_rule = this.frm.doc.ignore_pricing_rule;\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=1,\n\t\t\t\t() => this.frm.trigger('ignore_pricing_rule'),\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=_ignore_pricing_rule,\n\t\t\t\t() => this.frm.trigger('apply_pricing_rule'),\n\t\t\t\t() => this.frm._last_coupon_code = this.frm.doc.coupon_code\n\t\t\t]);\n\t\t}\n\t}\n};\n\nerpnext.show_serial_batch_selector = function (frm, d, callback, on_close, show_dialog) {\n\tlet warehouse, receiving_stock, existing_stock;\n\tif (frm.doc.is_return) {\n\t\tif ([\"Purchase Receipt\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t} else if ([\"Delivery Note\", \"Sales Invoice\"].includes(frm.doc.doctype)) {\n\t\t\treceiving_stock = true;\n\t\t}\n\t} else {\n\t\tif (frm.doc.doctype == \"Stock Entry\") {\n\t\t\tif (frm.doc.purpose == \"Material Receipt\") {\n\t\t\t\treceiving_stock = true;\n\t\t\t} else {\n\t\t\t\texisting_stock = true;\n\t\t\t\twarehouse = d.s_warehouse;\n\t\t\t}\n\t\t} else {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t}\n\t}\n\n\tif (!warehouse) {\n\t\tif (receiving_stock) {\n\t\t\twarehouse = [\"like\", \"\"];\n\t\t} else if (existing_stock) {\n\t\t\twarehouse = [\"!=\", \"\"];\n\t\t}\n\t}\n\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n\nerpnext.apply_putaway_rule = (frm, purpose=null) => {\n\tif (!frm.doc.company) {\n\t\tfrappe.throw({message: __(\"Please select a Company first.\"), title: __(\"Mandatory\")});\n\t}\n\tif (!frm.doc.items.length) return;\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.stock.doctype.putaway_rule.putaway_rule.apply_putaway_rule\",\n\t\targs: {\n\t\t\tdoctype: frm.doctype,\n\t\t\titems: frm.doc.items,\n\t\t\tcompany: frm.doc.company,\n\t\t\tsync: true,\n\t\t\tpurpose: purpose\n\t\t},\n\t\tcallback: (result) => {\n\t\t\tif (!result.exc && result.message) {\n\t\t\t\tfrm.clear_table(\"items\");\n\n\t\t\t\tlet items =  result.message;\n\t\t\t\titems.forEach((row) => {\n\t\t\t\t\tdelete row[\"name\"]; // dont overwrite name from server side\n\t\t\t\t\tlet child = frm.add_child(\"items\");\n\t\t\t\t\tObject.assign(child, row);\n\t\t\t\t\tfrm.script_manager.trigger(\"qty\", child.doctype, child.name);\n\t\t\t\t});\n\t\t\t\tfrm.get_field(\"items\").grid.refresh();\n\t\t\t}\n\t\t}\n\t});\n};\n", "erpnext.TransactionController = class TransactionController extends erpnext.TransactionController{\n\t// Metactical Customization: Add scan to confirm button functionality\n\tais_scan_to_confirm() {\n\t\tvar me = this;\n\t\tvar items = this.frm.doc.items;\n\t\tif(this.frm.doc.items && this.frm.doc.items.length > 0){\n\t\t\tvar fields = [\n\t\t\t\t{'fieldtype': 'Link', 'label': 'Item', 'options': 'Item', 'fieldname': 'item_code', 'in_list_view': 1},\n\t\t\t\t{'fieldtype': 'Float', 'label': 'Qty', 'fieldname': 'qty', 'in_list_view': 1}\n\t\t\t]\n\t\t\tvar scanned_dialog = new frappe.ui.Dialog({\n\t\t\t\t'fields': [\n\t\t\t\t\t{'fieldtype': 'Data', 'fieldname': 'barcode', 'label': 'Scan Barcode'},\n\t\t\t\t\t{'fieldtype': 'Table', 'fieldname': 'items', 'fields': fields, 'data': []}\n\t\t\t\t],\n\t\t\t\t'primary_action': function(){\n\t\t\t\t\tvar values = scanned_dialog.get_values('items');\n\t\t\t\t\tfor(let i in values.items){\n\t\t\t\t\t\tvar row = values.items[i];\n\t\t\t\t\t\tlet exists = items.filter((itm) => itm.item_code == row.item_code);\n\t\t\t\t\t\tif(exists.length > 0){\n\t\t\t\t\t\t\texists[0].qty = row.qty;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tscanned_dialog.hide();\n\t\t\t\t\tme.frm.refresh_field('items');\n\t\t\t\t},\n\t\t\t\t'secondary_action': function(){\n\t\t\t\t\tscanned_dialog.hide();\n\t\t\t\t},\n\t\t\t\t'secondary_action_label': 'Cancel',\n\t\t\t\t'no_submit_on_enter': true\n\t\t\t});\n\t\t\t\n\t\t\tscanned_dialog.barcode_scanned = function(){\n\t\t\t\tif(scanned_dialog.get_values()['barcode'] == '' || scanned_dialog.get_values()['barcode'] == null){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.search_for_serial_or_batch_or_barcode_number\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tsearch_value: scanned_dialog.get_values()['barcode']\n\t\t\t\t\t}\n\t\t\t\t}).then(r => {\n\t\t\t\t\tconst data = r && r.message;\n\t\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Wrong barcode\"),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tlet existing_item = items.filter((itm) => itm.item_code == data.item_code);\n\t\t\t\t\t\tif(existing_item.length > 0){\n\t\t\t\t\t\t\tvar dialog_data = scanned_dialog.fields_dict.items.grid.data;\n\t\t\t\t\t\t\tlet existing_row = dialog_data.filter((row) => row.item_code == data.item_code)\n\t\t\t\t\t\t\tif(existing_row.length > 0){\n\t\t\t\t\t\t\t\texisting_row[0].qty = existing_row[0].qty + 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tdialog_data.push({\"item_code\": data.item_code, \"qty\": 1})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tscanned_dialog.fields_dict.items.grid.refresh();\n\t\t\t\t\t\t\tscanned_dialog.fields_dict.barcode.set_value('');\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"alert\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Item not in list\"),\n\t\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\tscanned_dialog.fields_dict.barcode.input.onkeypress = function(event){\n\t\t\t\tif(event.keyCode == 13)\n\t\t\t\t{\n\t\t\t\t\tscanned_dialog.barcode_scanned();\n\t\t\t\t}\n\t\t\t};\n\t\t\tscanned_dialog.show();\n\t\t}\n\t}\n};\n", "\n\tfrappe.templates['item_selector'] = `<div class=\"app-listing item-list image-view-container item-selector\">\n{% for (var i=0; i < data.length; i++) { var item = data[i]; %}\n\t{% if (i % 4 === 0) { %}<div class=\"image-view-row\">{% } %}\n\t<div class=\"image-view-item\" data-name=\"{{ item.name }}\">\n\t\t<div class=\"image-view-header doclist-row\">\n\t\t\t<div class=\"list-value\">\n\t\t\t\t<a class=\"grey list-id\" data-name=\"{{item.name}}\"\n\t\t\t\t\ttitle=\"{{ item.item_name || item.name}}\">\n\t\t\t\t\t{{item.item_name || item.name}}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"image-view-body\">\n\t\t\t<a  data-item-code=\"{{ item.name }}\"\n\t\t\t\ttitle=\"{{ item.item_name || item.name }}\"\n\t\t\t>\n\t\t\t\t<div class=\"image-field\"\n\t\t\t\t\tstyle=\"\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t\tbackground-color: #fafbfc;\n\t\t\t\t\t{% } %}\n\t\t\t\t\tborder: 0px;\"\n\t\t\t\t>\n\t\t\t\t\t{% if (!item.image) { %}\n\t\t\t\t\t<span class=\"placeholder-text\">\n\t\t\t\t\t\t{%= frappe.get_abbr(item.item_name || item.name) %}\n\t\t\t\t\t</span>\n\t\t\t\t\t{% } %}\n\t\t\t\t\t{% if (item.image) { %}\n\t\t\t\t\t<img src=\"{{ item.image }}\" alt=\"{{item.item_name || item.name}}\">\n\t\t\t\t\t{% } %}\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t{% if ((i % 4 === 3) || (i===data.length - 1)) { %}</div>{% } %}\n{% endfor %}\n</div>\n`;\n", "erpnext.ItemSelector = class ItemSelector {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = \"item_code\";\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tvar me = this;\n\t\tif (!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__(\"Add Items\"), function () {\n\t\t\t\tif (!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tme.dialog.input.focus();\n\t\t\t\t}, 1000);\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Add Items\"),\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html(\n\t\t\t'<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>'\n\t\t);\n\n\t\tthis.dialog.input = body.find(\".form-control\");\n\t\tthis.dialog.results = body.find(\".results\");\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on(\"click\", \".image-view-item\", function () {\n\t\t\tme.add_item($(this).attr(\"data-name\"));\n\t\t});\n\n\t\tthis.dialog.input.on(\"keyup\", function () {\n\t\t\tif (me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function () {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t}\n\n\tadd_item(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif (d[this.item_field] === item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"qty\", d.qty + 1);\n\t\t\t\tfrappe.show_alert({ message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: \"green\" });\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => {\n\t\t\t\t\td = this.grid.add_new_row();\n\t\t\t\t},\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"qty\", 1);\n\t\t\t\t\tfrappe.show_alert({ message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: \"green\" });\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\trender_items() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {},\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function (r) {\n\t\t\t$.each(r.values, function (i, d) {\n\t\t\t\tif (!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template(\"item_selector\", { data: r.values }));\n\t\t});\n\t}\n};\n", "frappe.provide(\"frappe.help.help_links\");\n\nconst docsUrl = \"https://erpnext.com/docs/\";\n\nfrappe.help.help_links[\"Form/Rename Tool\"] = [\n\t{\n\t\tlabel: \"Bulk Rename\",\n\t\turl: docsUrl + \"user/manual/en/using-erpnext/articles/bulk-rename\",\n\t},\n];\n\n//Setup\n\nfrappe.help.help_links[\"List/User\"] = [\n\t{\n\t\tlabel: \"New User\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/users-and-permissions/adding-users\",\n\t},\n\t{\n\t\tlabel: \"Rename User\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/rename-user\",\n\t},\n];\n\nfrappe.help.help_links[\"permission-manager\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n\t{\n\t\tlabel: \"Managing Perm Level in Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/managing-perm-level\",\n\t},\n\t{\n\t\tlabel: \"User Permissions\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/users-and-permissions/user-permissions\",\n\t},\n\t{\n\t\tlabel: \"Sharing\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/users-and-permissions/sharing\",\n\t},\n\t{\n\t\tlabel: \"Password\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/change-password\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/System Settings\"] = [\n\t{\n\t\tlabel: \"System Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/system-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"module_setup\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Naming Series\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/naming-series\",\n\t},\n\t{\n\t\tlabel: \"Setting the Current Value for Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/naming-series-current-value\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Global Defaults\"] = [\n\t{\n\t\tlabel: \"Global Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/global-defaults\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Letter Head\"] = [\n\t{\n\t\tlabel: \"Letter Head\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/letter-head\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Address Template\"] = [\n\t{\n\t\tlabel: \"Address Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/address-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Terms and Conditions\"] = [\n\t{\n\t\tlabel: \"Terms and Conditions\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/terms-and-conditions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Cheque Print Template\"] = [\n\t{\n\t\tlabel: \"Cheque Print Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/cheque-print-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Account\"] = [\n\t{\n\t\tlabel: \"Email Account\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-account\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Auto Email Report\"] = [\n\t{\n\t\tlabel: \"Auto Email Reports\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/auto-email-reports\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Settings\"] = [\n\t{\n\t\tlabel: \"Print Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"print-format-builder\"] = [\n\t{\n\t\tlabel: \"Print Format Builder\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-format-builder\",\n\t},\n];\n\n//setup-integrations\n\nfrappe.help.help_links[\"Form/PayPal Settings\"] = [\n\t{\n\t\tlabel: \"PayPal Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/paypal-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Razorpay Settings\"] = [\n\t{\n\t\tlabel: \"Razorpay Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/razorpay-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Settings\"] = [\n\t{\n\t\tlabel: \"Dropbox Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/dropbox-backup\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/LDAP Settings\"] = [\n\t{\n\t\tlabel: \"LDAP Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/ldap-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stripe Settings\"] = [\n\t{\n\t\tlabel: \"Stripe Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/stripe-integration\",\n\t},\n];\n\n//Sales\n\nfrappe.help.help_links[\"Form/Quotation\"] = [\n\t{ label: \"Quotation\", url: docsUrl + \"user/manual/en/selling/quotation\" },\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Drop Shipping\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/drop-shipping\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Close Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/close-sales-order\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Product Bundle\"] = [\n\t{\n\t\tlabel: \"Product Bundle\",\n\t\turl: docsUrl + \"user/manual/en/selling/product-bundle\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Selling Settings\"] = [\n\t{\n\t\tlabel: \"Selling Settings\",\n\t\turl: docsUrl + \"user/manual/en/selling/selling-settings\",\n\t},\n];\n\n//Buying\n\nfrappe.help.help_links[\"List/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Request for Quotation\"] = [\n\t{\n\t\tlabel: \"Request for Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/request-for-quotation\",\n\t},\n\t{\n\t\tlabel: \"RFQ Video\",\n\t\turl: docsUrl + \"user/videos/learn/request-for-quotation.html\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Supplier Quotation\"] = [\n\t{\n\t\tlabel: \"Supplier Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/supplier-quotation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Buying Settings\"] = [\n\t{\n\t\tlabel: \"Buying Settings\",\n\t\turl: docsUrl + \"user/manual/en/buying/setup/buying-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Item UoM\",\n\t\turl: docsUrl + \"user/manual/en/buying/articles/purchasing-in-different-unit\",\n\t},\n\t{\n\t\tlabel: \"Supplier Item Code\",\n\t\turl: docsUrl + \"user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Price List\"] = [\n\t{\n\t\tlabel: \"Price List\",\n\t\turl: docsUrl + \"user/manual/en/stock/price-lists\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Authorization Rule\"] = [\n\t{\n\t\tlabel: \"Authorization Rule\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/authorization-rule\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/SMS Settings\"] = [\n\t{\n\t\tlabel: \"SMS Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/sms-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Stock Reconciliation\",\n\t\turl: docsUrl + \"user/manual/en/stock/stock-reconciliation\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Territory\"] = [\n\t{\n\t\tlabel: \"Territory\",\n\t\turl: docsUrl + \"user/manual/en/selling/territory\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Workflow\"] = [\n\t{ label: \"Workflow\", url: docsUrl + \"user/manual/en/setting-up/workflows\" },\n];\n\nfrappe.help.help_links[\"List/Company\"] = [\n\t{\n\t\tlabel: \"Company\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/company-setup\",\n\t},\n\t{\n\t\tlabel: \"Delete All Related Transactions for a Company\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions\",\n\t},\n];\n\n//Accounts\n\nfrappe.help.help_links[\"Tree/Account\"] = [\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/accounts/chart-of-accounts\",\n\t},\n\t{\n\t\tlabel: \"Managing Tree Mastes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balances\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"point-of-sale\"] = [\n\t{\n\t\tlabel: \"Point of Sale Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/point-of-sales\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"Point of Sale Profile\",\n\t\turl: docsUrl + \"user/manual/en/accounts/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/POS Profile\"] = [\n\t{\n\t\tlabel: \"POS Profile\",\n\t\turl: docsUrl + \"user/manual/en/accounts/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Invoice\"] = [\n\t{\n\t\tlabel: \"Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/purchase-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Journal Entry\"] = [\n\t{\n\t\tlabel: \"Journal Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/journal-entry\",\n\t},\n\t{\n\t\tlabel: \"Advance Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/advance-payment-entry\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Entry\"] = [\n\t{\n\t\tlabel: \"Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-entry\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Request\"] = [\n\t{\n\t\tlabel: \"Payment Request\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-request\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset\"] = [\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset Category\"] = [\n\t{\n\t\tlabel: \"Asset Category\",\n\t\turl: docsUrl + \"user/manual/en/asset/asset-category\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Cost Center\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\n//Stock\n\nfrappe.help.help_links[\"List/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl: docsUrl + \"user/manual/en/stock/item/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Receipt\"] = [\n\t{\n\t\tlabel: \"Purchase Receipt\",\n\t\turl: docsUrl + \"user/manual/en/stock/purchase-receipt\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Installation Note\"] = [\n\t{\n\t\tlabel: \"Installation Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/installation-note\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Budget\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\nfrappe.help.help_links[\"List/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n\t{\n\t\tlabel: \"Stock Entry Types\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/stock-entry-purpose\",\n\t},\n\t{\n\t\tlabel: \"Repack Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/repack-entry\",\n\t},\n\t{\n\t\tlabel: \"Opening Stock\",\n\t\turl: docsUrl + \"user/manual/en/stock/opening-stock\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n];\n\nfrappe.help.help_links[\"Tree/Warehouse\"] = [\n\t{ label: \"Warehouse\", url: docsUrl + \"user/manual/en/stock/warehouse\" },\n];\n\nfrappe.help.help_links[\"List/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"List/Batch\"] = [{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" }];\n\nfrappe.help.help_links[\"Form/Batch\"] = [{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" }];\n\nfrappe.help.help_links[\"Form/Packing Slip\"] = [\n\t{\n\t\tlabel: \"Packing Slip\",\n\t\turl: docsUrl + \"user/manual/en/stock/packing-slip\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Quality Inspection\"] = [\n\t{\n\t\tlabel: \"Quality Inspection\",\n\t\turl: docsUrl + \"user/manual/en/stock/quality-inspection\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Landed Cost Voucher\"] = [\n\t{\n\t\tlabel: \"Landed Cost Voucher\",\n\t\turl: docsUrl + \"user/manual/en/stock/landed-cost-voucher\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Item Group\"] = [\n\t{\n\t\tlabel: \"Item Group\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-group\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item Attribute\"] = [\n\t{\n\t\tlabel: \"Item Attribute\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-attribute\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/UOM\"] = [\n\t{\n\t\tlabel: \"Fractions in UOM\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/managing-fractions-in-uom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Opening Stock Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/stock-reconciliation\",\n\t},\n];\n\n//CRM\n\nfrappe.help.help_links[\"Form/Lead\"] = [{ label: \"Lead\", url: docsUrl + \"user/manual/en/CRM/lead\" }];\n\nfrappe.help.help_links[\"Form/Opportunity\"] = [\n\t{ label: \"Opportunity\", url: docsUrl + \"user/manual/en/CRM/opportunity\" },\n];\n\nfrappe.help.help_links[\"Form/Address\"] = [{ label: \"Address\", url: docsUrl + \"user/manual/en/CRM/address\" }];\n\nfrappe.help.help_links[\"Form/Contact\"] = [{ label: \"Contact\", url: docsUrl + \"user/manual/en/CRM/contact\" }];\n\nfrappe.help.help_links[\"Form/Newsletter\"] = [\n\t{ label: \"Newsletter\", url: docsUrl + \"user/manual/en/CRM/newsletter\" },\n];\n\nfrappe.help.help_links[\"Form/Campaign\"] = [\n\t{ label: \"Campaign\", url: docsUrl + \"user/manual/en/CRM/campaign\" },\n];\n\nfrappe.help.help_links[\"Tree/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/CRM/sales-person\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person Target\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-person-target-allocation\",\n\t},\n\t{\n\t\tlabel: \"Sales Person in Transactions\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n];\n\n//Manufacturing\n\nfrappe.help.help_links[\"Form/BOM\"] = [\n\t{\n\t\tlabel: \"Bill of Material\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bill-of-materials\",\n\t},\n\t{\n\t\tlabel: \"Nested BOM Structure\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/articles/managing-multi-level-bom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Work Order\"] = [\n\t{\n\t\tlabel: \"Work Order\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/work-order\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Workstation\"] = [\n\t{\n\t\tlabel: \"Workstation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/workstation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Operation\"] = [\n\t{\n\t\tlabel: \"Operation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/operation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/BOM Update Tool\"] = [\n\t{\n\t\tlabel: \"BOM Update Tool\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bom-update-tool\",\n\t},\n];\n\n//Customize\n\nfrappe.help.help_links[\"Form/Customize Form\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n\t{\n\t\tlabel: \"Customize Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/customize-form\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n", "frappe.provide(\"agriculture\");\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require(\"assets/frappe/js/lib/snap.svg-min.js\", () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get(\"black\"),\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [s + t * Snap.cos(60), s, s, s + t * Snap.cos(30), s + t, s + t * Snap.cos(30)],\n\t\t\t\tcolor: frappe.ui.color.get(\"peach\"),\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"pink\"),\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p,\n\t\t\t\t\ts + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60),\n\t\t\t\t\ts + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p,\n\t\t\t\t\ts + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"pink\", \"light\"),\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60),\n\t\t\t\t\ts + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p,\n\t\t\t\t\ts + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p,\n\t\t\t\t\ts + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p,\n\t\t\t\t\ts + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60),\n\t\t\t\t\ts + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"brown\"),\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60),\n\t\t\t\t\ts + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60),\n\t\t\t\t\ts + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60),\n\t\t\t\t\ts + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"green\", \"dark\"),\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60),\n\t\t\t\t\ts + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t\ts + t,\n\t\t\t\t\ts + t * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"green\"),\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60),\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p,\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p,\n\t\t\t\t\ts + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60),\n\t\t\t\t\ts + 72.5 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"cyan\", \"dark\"),\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60),\n\t\t\t\t\ts + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p,\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60),\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"cyan\"),\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p,\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p,\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p,\n\t\t\t\t\ts + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p,\n\t\t\t\t\ts + 72.5 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"green\", \"light\"),\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p,\n\t\t\t\t\ts + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p,\n\t\t\t\t\ts + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p,\n\t\t\t\t\ts + 72.5 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"pink\", \"dark\"),\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p,\n\t\t\t\t\ts + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"red\"),\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60),\n\t\t\t\t\ts,\n\t\t\t\t\ts + 55 * p * Snap.cos(60),\n\t\t\t\t\ts + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p,\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p,\n\t\t\t\t\ts + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60),\n\t\t\t\t\ts + 40 * p * Snap.cos(30),\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get(\"yellow\"),\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth,\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text((t * Snap.cos(60)) / 2, s + (t * Snap.cos(30)) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get(\"black\"),\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + (t * Snap.cos(30)) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get(\"black\"),\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get(\"black\"),\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once) {\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0 + offset, 0 + index * 20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get(\"black\"),\n\t\t\t});\n\t\t\tlet text = this.paper.text(5 + offset, 16 + index * 20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"black\"),\n\t\t\t\t\"font-size\": 12,\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({ clay, sand, silt } = this) {\n\t\tif (clay + sand + silt != 0) {\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2,\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== \"undefined\") this.blip.remove();\n\t}\n};\n", "\n\tfrappe.templates['item_quick_entry'] = `<div class=\"h6 uppercase\" style=\"margin-top: 30px;\">{{ __(\"Variant Attributes\") }}</div>\n<div class=\"attributes hide-control\">\n</div>\n`;\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.ItemQuickEntryForm = class ItemQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert) {\n\t\tsuper(doctype, after_insert);\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis.check_naming_series_based_on();\n\t\tsuper.render_dialog();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper\n\t\t\t.find(\".edit-full\")\n\t\t\t.text(__(\"Edit in full page for more options like assets, serial nos, batches etc.\"));\n\t}\n\n\tcheck_naming_series_based_on() {\n\t\tif (frappe.defaults.get_default(\"item_naming_by\") === \"Naming Series\") {\n\t\t\tthis.mandatory = this.mandatory.filter((d) => d.fieldname !== \"item_code\");\n\t\t}\n\t}\n\n\tinit_post_render_dialog_operations() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t}\n\n\tregister_primary_action() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__(\"Save\"), function () {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values[\"variant_based_on\"] == \"Manufacturer\") {\n\t\t\t\t\tvalues[\"variant_based_on\"] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t}\n\n\tinsert(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise((resolve) => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function () {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function () {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t});\n\t\t});\n\t}\n\n\topen_doc() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template) frappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route(\"Form\", this.doctype, this.doc.name);\n\t\t}\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"create_variant\",\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: __(\"Create Variant\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"item_template\",\n\t\t\t\tlabel: __(\"Item Template\"),\n\t\t\t\treqd: 0,\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Item\",\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\thas_variants: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\treturn variant_fields;\n\t}\n\n\tget_manufacturing_fields() {\n\t\tthis.manufacturer_fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Manufacturer\",\n\t\t\t\tlabel: \"Manufacturer\",\n\t\t\t\tfieldname: \"manufacturer\",\n\t\t\t\thidden: 1,\n\t\t\t\treqd: 0,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tlabel: \"Manufacturer Part Number\",\n\t\t\t\tfieldname: \"manufacturer_part_no\",\n\t\t\t\thidden: 1,\n\t\t\t\treqd: 0,\n\t\t\t},\n\t\t];\n\t\treturn this.manufacturer_fields;\n\t}\n\n\tget_attributes_fields() {\n\t\tvar attribute_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"attribute_html\",\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t},\n\t\t];\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t}\n\n\tinit_for_create_variant_trigger() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function () {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t}\n\n\tpreset_fields_for_template() {\n\t\tvar for_variant = this.dialog.get_value(\"create_variant\");\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value(\"\");\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t[\"item_code\", \"item_name\", \"item_group\", \"stock_uom\"].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field(\"attribute_html\").toggle(false);\n\n\t\t// non mandatory for variants\n\t\t[\"item_code\", \"stock_uom\", \"item_group\"].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\t}\n\n\tinit_for_item_template_trigger() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\tme.template_doc.attributes,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field(\"attribute_html\").toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t};\n\t}\n\n\tinit_post_template_trigger_operations(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper\n\t\t\t.find(\".attributes\")\n\t\t\t.toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper\n\t\t\t.find(\".attributes-header\")\n\t\t\t.toggleClass(\"hide-control\", attributes_flag);\n\t}\n\n\ttoggle_manufacturer_fields() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function (i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd =\n\t\t\t\tdialog_field.fieldname == \"manufacturer\" ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t}\n\n\tinitiate_render_attributes() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t}\n\n\trender_attributes(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field(\"attribute_html\").toggle(true);\n\n\t\t$.each(attributes, function (index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc =\n\t\t\t\t\t\"Min Value: \" +\n\t\t\t\t\trow.from_range +\n\t\t\t\t\t\" , Max Value: \" +\n\t\t\t\t\trow.to_range +\n\t\t\t\t\t\", in Increments of: \" +\n\t\t\t\t\trow.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\n\t\t\t\t\"has-error\",\n\t\t\t\tme.attribute_values[row.attribute] ? false : true\n\t\t\t);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(\n\t\t\t\t\trepl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\tdesc: desc,\n\t\t\t\t\t})\n\t\t\t\t).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function () {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this)\n\t\t\t\t\t\t.closest(\".frappe-control\")\n\t\t\t\t\t\t.toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_make_control(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: fieldtype,\n\t\t\t\tlabel: row.attribute,\n\t\t\t\tfieldname: row.attribute,\n\t\t\t\toptions: row.options || \"\",\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false,\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t}\n\n\tinit_awesomplete_for_attribute(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input\n\t\t\t.on(\"input\", function (e) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\t\tfilters: [\n\t\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"],\n\t\t\t\t\t\t],\n\t\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\t\tparent: \"Item Attribute\",\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function (d) {\n\t\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t})\n\t\t\t.on(\"focus\", function (e) {\n\t\t\t\t$(e.target).val(\"\").trigger(\"input\");\n\t\t\t})\n\t\t\t.on(\"awesomplete-close\", function (e) {\n\t\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t\t$(e.target)\n\t\t\t\t\t.closest(\".frappe-control\")\n\t\t\t\t\t.toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t\t});\n\t}\n\n\tget_variant_doc() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\ttemplate: me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute,\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(\n\t\t\t\t\t\t\t__(\"Item Variant {0} already exists with same attributes\", [\n\t\t\t\t\t\t\t\trepl(\n\t\t\t\t\t\t\t\t\t'<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>',\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titem: r.message,\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function () {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn variant_doc;\n\t}\n\n\tvalidate_mandatory_attributes() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function (index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t});\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function (index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n};\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.ContactAddressQuickEntryForm = class ContactAddressQuickEntryForm extends (\n\tfrappe.ui.form.QuickEntryForm\n) {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tinsert() {\n\t\t/**\n\t\t * Using alias fieldnames because the doctype definition define \"email_id\" and \"mobile_no\" as readonly fields.\n\t\t * Therefor, resulting in the fields being \"hidden\".\n\t\t */\n\t\tconst map_field_names = {\n\t\t\temail_address: \"email_id\",\n\t\t\tmobile_number: \"mobile_no\",\n\t\t};\n\n\t\tObject.entries(map_field_names).forEach(([fieldname, new_fieldname]) => {\n\t\t\tthis.dialog.doc[new_fieldname] = this.dialog.doc[fieldname];\n\t\t\tdelete this.dialog.doc[fieldname];\n\t\t});\n\n\t\treturn super.insert();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\t\tcollapsible: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Email Id\"),\n\t\t\t\tfieldname: \"email_address\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\toptions: \"Email\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\t\tfieldname: \"mobile_number\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\t\tcollapsible: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\t\tfieldname: \"address_line1\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\t\tfieldname: \"address_line2\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\t\tfieldname: \"pincode\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"City\"),\n\t\t\t\tfieldname: \"city\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"State\"),\n\t\t\t\tfieldname: \"state\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Country\"),\n\t\t\t\tfieldname: \"country\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Country\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\t\tfieldname: \"customer_pos_id\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\thidden: 1,\n\t\t\t},\n\t\t];\n\n\t\treturn variant_fields;\n\t}\n};\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.ContactAddressQuickEntryForm;\n", "frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.SupplierQuickEntryForm = frappe.ui.form.ContactAddressQuickEntryForm;\n", "class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tfrappe.utils.play_sound(\"incoming-call\");\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\tstatic: true,\n\t\t\tminimizable: true,\n\t\t});\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.setup_dialog();\n\t\tthis.set_call_status();\n\t\tfrappe.utils.bind_actions_with_object(this.dialog.$body, this);\n\t\tthis.dialog.$wrapper.addClass(\"call-popup\");\n\t\tthis.dialog.get_close_btn().unbind(\"click\").click(this.close_modal.bind(this));\n\t\tthis.dialog.show();\n\t}\n\n\tsetup_dialog() {\n\t\tthis.setup_call_details();\n\t\tthis.dialog.$body.empty().append(this.caller_info);\n\t}\n\n\tset_indicator(color, blink = false) {\n\t\tlet classes = `indicator ${color} ${blink ? \"blink\" : \"\"}`;\n\t\tthis.dialog.header.find(\".indicator\").attr(\"class\", classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = \"\";\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif ([\"Ringing\"].includes(call_status) || !call_status) {\n\t\t\ttitle = __(\"Incoming call from {0}\", [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator(\"blue\", true);\n\t\t} else if (call_status === \"In Progress\") {\n\t\t\ttitle = __(\"Call Connected\");\n\t\t\tthis.set_indicator(\"green\");\n\t\t} else if ([\"No Answer\", \"Missed\"].includes(call_status)) {\n\t\t\tthis.set_indicator(\"yellow\");\n\t\t\ttitle = __(\"Call Missed\");\n\t\t} else if ([\"Completed\", \"Busy\", \"Failed\"].includes(call_status)) {\n\t\t\tthis.set_indicator(\"red\");\n\t\t\ttitle = __(\"Call Ended\");\n\t\t} else {\n\t\t\tthis.set_indicator(\"blue\");\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log, missed) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status(missed ? \"Missed\" : null);\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_ended(call_log, missed) {\n\t\tfrappe.utils.play_sound(\"call-disconnect\");\n\t\tthis.update_call_log(call_log, missed);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value(\"call_summary\")) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 60000);\n\t\tthis.clear_listeners();\n\t}\n\n\tget_caller_name() {\n\t\tconst contact_link = this.get_contact_link();\n\t\treturn contact_link.link_title || contact_link.link_name;\n\t}\n\n\tget_contact_link() {\n\t\tlet log = this.call_log;\n\t\tlet contact_link = log.links.find((d) => d.link_doctype === \"Contact\");\n\t\treturn contact_link || {};\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_ended`, (call_log) => {\n\t\t\tthis.call_ended(call_log);\n\t\t});\n\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_missed`, (call_log) => {\n\t\t\tthis.call_ended(call_log, true);\n\t\t});\n\t}\n\n\tclear_listeners() {\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_ended`);\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_missed`);\n\t}\n\n\tsetup_call_details() {\n\t\tthis.caller_info = $(`<div></div>`);\n\t\tthis.call_details = new frappe.ui.FieldGroup({\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"name\",\n\t\t\t\t\tlabel: \"Name\",\n\t\t\t\t\tdefault: this.get_caller_name() || __(\"Unknown Caller\"),\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Open Contact\"),\n\t\t\t\t\tclick: () => frappe.set_route(\"Form\", \"Contact\", this.get_contact_link().link_name),\n\t\t\t\t\tdepends_on: () => this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Create New Contact\"),\n\t\t\t\t\tclick: this.create_new_contact.bind(this),\n\t\t\t\t\tdepends_on: () => !this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Create New Customer\"),\n\t\t\t\t\tclick: this.create_new_customer.bind(this),\n\t\t\t\t\tdepends_on: () => !this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Create New Lead\"),\n\t\t\t\t\tclick: () => frappe.new_doc(\"Lead\", { mobile_no: this.caller_number }),\n\t\t\t\t\tdepends_on: () => !this.get_caller_name(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"number\",\n\t\t\t\t\tlabel: \"Phone Number\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tdefault: this.caller_number,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\t\thide_border: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"call_type\",\n\t\t\t\t\tlabel: \"Call Type\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Telephony Call Type\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\t\thide_border: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t\tlabel: __(\"Call Summary\"),\n\t\t\t\t\tfieldname: \"call_summary\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tlabel: __(\"Save\"),\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tconst call_summary = this.call_details.get_value(\"call_summary\");\n\t\t\t\t\t\tconst call_type = this.call_details.get_value(\"call_type\");\n\t\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\t\tfrappe\n\t\t\t\t\t\t\t.xcall(\n\t\t\t\t\t\t\t\t\"erpnext.telephony.doctype.call_log.call_log.add_call_summary_and_call_type\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcall_log: this.call_log.name,\n\t\t\t\t\t\t\t\t\tsummary: call_summary,\n\t\t\t\t\t\t\t\t\tcall_type: call_type,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__(\"Call Summary Saved\")}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"/app/call-log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__(\"View call log\")}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tbody: this.caller_info,\n\t\t});\n\t\tthis.call_details.make();\n\t}\n\n\tis_known_caller() {\n\t\treturn Boolean(this.get_caller_name());\n\t}\n\n\tcreate_new_customer() {\n\t\t// to avoid quick entry form\n\t\tconst new_customer = frappe.model.get_new_doc(\"Customer\");\n\t\tnew_customer.mobile_no = this.caller_number;\n\t\tfrappe.set_route(\"Form\", new_customer.doctype, new_customer.name);\n\t}\n\n\tcreate_new_contact() {\n\t\t// TODO: fix new_doc, it should accept child table values\n\t\tconst new_contact = frappe.model.get_new_doc(\"Contact\");\n\t\tconst phone_no = frappe.model.add_child(new_contact, \"Contact Phone\", \"phone_nos\");\n\t\tphone_no.phone = this.caller_number;\n\t\tphone_no.is_primary_mobile_no = 1;\n\t\tfrappe.set_route(\"Form\", new_contact.doctype, new_contact.name);\n\t}\n}\n\n$(document).on(\"app_ready\", function () {\n\tfrappe.realtime.on(\"show_call_popup\", (call_log) => {\n\t\tlet call_popup = erpnext.call_popup;\n\t\tif (call_popup && call_log.name === call_popup.call_log.name) {\n\t\t\tcall_popup.update_call_log(call_log);\n\t\t\tcall_popup.dialog.show();\n\t\t} else {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t}\n\t});\n});\n\nwindow.CallPopup = CallPopup;\n", "frappe.provide(\"erpnext.accounts\");\n\nerpnext.accounts.dimensions = {\n\tsetup_dimension_filters(frm, doctype) {\n\t\tthis.accounting_dimensions = [];\n\t\tthis.default_dimensions = {};\n\t\tthis.fetch_custom_dimensions(frm, doctype);\n\t},\n\n\tfetch_custom_dimensions(frm, doctype) {\n\t\tlet me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\targs: {\n\t\t\t\twith_cost_center_and_project: true,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tme.accounting_dimensions = r.message[0];\n\t\t\t\t// Ignoring \"Project\" as it is already handled specifically in Sales Order and Delivery Note\n\t\t\t\tme.accounting_dimensions = me.accounting_dimensions.filter((x) => {\n\t\t\t\t\treturn x.document_type != \"Project\";\n\t\t\t\t});\n\t\t\t\tme.default_dimensions = r.message[1];\n\t\t\t\tme.setup_filters(frm, doctype);\n\t\t\t},\n\t\t});\n\t},\n\n\tsetup_filters(frm, doctype) {\n\t\tif (doctype == \"Payment Entry\" && this.accounting_dimensions) {\n\t\t\tfrm.dimension_filters = this.accounting_dimensions;\n\t\t}\n\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension[\"document_type\"], () => {\n\t\t\t\t\tlet parent_fields = [];\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\t\tif (df.fieldtype === \"Link\" && df.options === \"Account\") {\n\t\t\t\t\t\t\tparent_fields.push(df.fieldname);\n\t\t\t\t\t\t} else if (df.fieldtype === \"Table\") {\n\t\t\t\t\t\t\tthis.setup_child_filters(frm, df.options, df.fieldname, dimension[\"fieldname\"]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension[\"fieldname\"])) {\n\t\t\t\t\t\t\tthis.setup_account_filters(frm, dimension[\"fieldname\"], parent_fields);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_child_filters(frm, doctype, parentfield, dimension) {\n\t\tlet fields = [];\n\n\t\tif (frappe.meta.has_field(doctype, dimension)) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\tif (df.fieldtype === \"Link\" && df.options === \"Account\") {\n\t\t\t\t\t\tfields.push(df.fieldname);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrm.set_query(dimension, parentfield, function (doc, cdt, cdn) {\n\t\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\t\treturn erpnext.queries.get_filtered_dimensions(row, fields, dimension, doc.company);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_account_filters(frm, dimension, fields) {\n\t\tfrm.set_query(dimension, function (doc) {\n\t\t\treturn erpnext.queries.get_filtered_dimensions(doc, fields, dimension, doc.company);\n\t\t});\n\t},\n\n\tupdate_dimension(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tif (frm.is_new()) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tfrm.doc.company &&\n\t\t\t\t\t\tObject.keys(this.default_dimensions || {}).length > 0 &&\n\t\t\t\t\t\tthis.default_dimensions[frm.doc.company]\n\t\t\t\t\t) {\n\t\t\t\t\t\tlet default_dimension =\n\t\t\t\t\t\t\tthis.default_dimensions[frm.doc.company][dimension[\"fieldname\"]];\n\n\t\t\t\t\t\tif (default_dimension) {\n\t\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension[\"fieldname\"])) {\n\t\t\t\t\t\t\t\tfrm.set_value(dimension[\"fieldname\"], default_dimension);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$.each(frm.doc.items || frm.doc.accounts || [], function (i, row) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\t\t\trow.doctype,\n\t\t\t\t\t\t\t\t\trow.name,\n\t\t\t\t\t\t\t\t\tdimension[\"fieldname\"],\n\t\t\t\t\t\t\t\t\tdefault_dimension\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcopy_dimension_from_first_row(frm, cdt, cdn, fieldname) {\n\t\tif (frappe.meta.has_field(frm.doctype, fieldname) && this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tlet row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(fieldname, row, [dimension[\"fieldname\"]]);\n\t\t\t});\n\t\t}\n\t},\n};\n", "frappe.provide(\"erpnext.accounts\");\n\nerpnext.accounts.unreconcile_payment = {\n\tadd_unreconcile_btn(frm) {\n\t\tif (frm.doc.docstatus == 1) {\n\t\t\tif (\n\t\t\t\t(frm.doc.doctype == \"Journal Entry\" && frm.doc.voucher_type != \"Journal Entry\") ||\n\t\t\t\t![\"Purchase Invoice\", \"Sales Invoice\", \"Journal Entry\", \"Payment Entry\"].includes(\n\t\t\t\t\tfrm.doc.doctype\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.unreconcile_payment.unreconcile_payment.doc_has_references\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\tdocname: frm.doc.name,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tfrm.add_custom_button(\n\t\t\t\t\t\t\t__(\"UnReconcile\"),\n\t\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\t\terpnext.accounts.unreconcile_payment.build_unreconcile_dialog(frm);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t__(\"Actions\")\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\n\tbuild_selection_map(frm, selections) {\n\t\t// assuming each row is an individual voucher\n\t\t// pass this to server side method that creates unreconcile doc for each row\n\t\tlet selection_map = [];\n\t\tif ([\"Sales Invoice\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\tselection_map = selections.map(function (elem) {\n\t\t\t\treturn {\n\t\t\t\t\tcompany: elem.company,\n\t\t\t\t\tvoucher_type: elem.voucher_type,\n\t\t\t\t\tvoucher_no: elem.voucher_no,\n\t\t\t\t\tagainst_voucher_type: frm.doc.doctype,\n\t\t\t\t\tagainst_voucher_no: frm.doc.name,\n\t\t\t\t};\n\t\t\t});\n\t\t} else if ([\"Payment Entry\", \"Journal Entry\"].includes(frm.doc.doctype)) {\n\t\t\tselection_map = selections.map(function (elem) {\n\t\t\t\treturn {\n\t\t\t\t\tcompany: elem.company,\n\t\t\t\t\tvoucher_type: frm.doc.doctype,\n\t\t\t\t\tvoucher_no: frm.doc.name,\n\t\t\t\t\tagainst_voucher_type: elem.voucher_type,\n\t\t\t\t\tagainst_voucher_no: elem.voucher_no,\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\treturn selection_map;\n\t},\n\n\tbuild_unreconcile_dialog(frm) {\n\t\tif (\n\t\t\t[\"Sales Invoice\", \"Purchase Invoice\", \"Payment Entry\", \"Journal Entry\"].includes(frm.doc.doctype)\n\t\t) {\n\t\t\tlet child_table_fields = [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Voucher Type\"),\n\t\t\t\t\tfieldname: \"voucher_type\",\n\t\t\t\t\tfieldtype: \"Dynamic Link\",\n\t\t\t\t\toptions: \"DocType\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Voucher No\"),\n\t\t\t\t\tfieldname: \"voucher_no\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"voucher_type\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Allocated Amount\"),\n\t\t\t\t\tfieldname: \"allocated_amount\",\n\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\toptions: \"account_currency\",\n\t\t\t\t},\n\t\t\t\t{ label: __(\"Currency\"), fieldname: \"account_currency\", fieldtype: \"Currency\", read_only: 1 },\n\t\t\t];\n\t\t\tlet unreconcile_dialog_fields = [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Allocations\"),\n\t\t\t\t\tfieldname: \"allocations\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tfields: child_table_fields,\n\t\t\t\t},\n\t\t\t];\n\n\t\t\t// get linked payments\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.unreconcile_payment.unreconcile_payment.get_linked_payments_for_doc\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\tdoctype: frm.doc.doctype,\n\t\t\t\t\tdocname: frm.doc.name,\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t// populate child table with allocations\n\t\t\t\t\t\tunreconcile_dialog_fields[0].data = r.message;\n\t\t\t\t\t\tunreconcile_dialog_fields[0].get_data = function () {\n\t\t\t\t\t\t\treturn r.message;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\ttitle: \"UnReconcile Allocations\",\n\t\t\t\t\t\t\tfields: unreconcile_dialog_fields,\n\t\t\t\t\t\t\tsize: \"large\",\n\t\t\t\t\t\t\tcannot_add_rows: true,\n\t\t\t\t\t\t\tprimary_action_label: \"UnReconcile\",\n\t\t\t\t\t\t\tprimary_action(values) {\n\t\t\t\t\t\t\t\tlet selected_allocations = values.allocations.filter((x) => x.__checked);\n\t\t\t\t\t\t\t\tif (selected_allocations.length > 0) {\n\t\t\t\t\t\t\t\t\tlet selection_map =\n\t\t\t\t\t\t\t\t\t\terpnext.accounts.unreconcile_payment.build_selection_map(\n\t\t\t\t\t\t\t\t\t\t\tfrm,\n\t\t\t\t\t\t\t\t\t\t\tselected_allocations\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\terpnext.accounts.unreconcile_payment.create_unreconcile_docs(\n\t\t\t\t\t\t\t\t\t\tselection_map\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfrappe.msgprint(\"No Selection\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\td.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n\n\tcreate_unreconcile_docs(selection_map) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.unreconcile_payment.unreconcile_payment.create_unreconcile_doc_for_selection\",\n\t\t\targs: {\n\t\t\t\tselections: selection_map,\n\t\t\t},\n\t\t});\n\t},\n};\n", "erpnext.utils.BarcodeScanner = class BarcodeScanner {\n\tconstructor(opts) {\n\t\tthis.frm = opts.frm;\n\t\t// frappe.flags.trigger_from_barcode_scanner is used for custom scripts\n\n\t\t// field from which to capture input of scanned data\n\t\tthis.scan_field_name = opts.scan_field_name || \"scan_barcode\";\n\t\tthis.scan_barcode_field = this.frm.fields_dict[this.scan_field_name];\n\n\t\tthis.barcode_field = opts.barcode_field || \"barcode\";\n\t\tthis.serial_no_field = opts.serial_no_field || \"serial_no\";\n\t\tthis.batch_no_field = opts.batch_no_field || \"batch_no\";\n\t\tthis.uom_field = opts.uom_field || \"uom\";\n\t\tthis.qty_field = opts.qty_field || \"qty\";\n\t\t// field name on row which defines max quantity to be scanned e.g. picklist\n\t\tthis.max_qty_field = opts.max_qty_field;\n\t\t// scanner won't add a new row if this flag is set.\n\t\tthis.dont_allow_new_row = opts.dont_allow_new_row;\n\t\t// scanner will ask user to type the quantity instead of incrementing by 1\n\t\tthis.prompt_qty = opts.prompt_qty;\n\n\t\tthis.items_table_name = opts.items_table_name || \"items\";\n\t\tthis.items_table = this.frm.doc[this.items_table_name];\n\n\t\t// optional sound name to play when scan either fails or passes.\n\t\t// see https://frappeframework.com/docs/v14/user/en/python-api/hooks#sounds\n\t\tthis.success_sound = opts.play_success_sound;\n\t\tthis.fail_sound = opts.play_fail_sound;\n\n\t\t// any API that takes `search_value` as input and returns dictionary as follows\n\t\t// {\n\t\t//     item_code: \"HORSESHOE\", // present if any item was found\n\t\t//     bar_code: \"123456\", // present if barcode was scanned\n\t\t//     batch_no: \"LOT12\", // present if batch was scanned\n\t\t//     serial_no: \"987XYZ\", // present if serial no was scanned\n\t\t//     uom: \"Kg\", // present if barcode UOM is different from default\n\t\t// }\n\t\tthis.scan_api = opts.scan_api || \"erpnext.stock.utils.scan_barcode\";\n\t}\n\n\tprocess_scan() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet me = this;\n\n\t\t\tconst input = this.scan_barcode_field.value;\n\t\t\tthis.scan_barcode_field.set_value(\"\");\n\t\t\tif (!input) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.scan_api_call(input, (r) => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tthis.show_alert(__(\"Cannot find Item with this Barcode\"), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.update_table(data)\n\t\t\t\t\t.then((row) => {\n\t\t\t\t\t\tthis.play_success_sound();\n\t\t\t\t\t\tresolve(row);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tthis.play_fail_sound();\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tscan_api_call(input, callback) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: this.scan_api,\n\t\t\t\targs: {\n\t\t\t\t\tsearch_value: input,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tcallback(r);\n\t\t\t});\n\t}\n\n\tupdate_table(data) {\n\t\treturn new Promise((resolve) => {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tfrappe.flags.trigger_from_barcode_scanner = true;\n\n\t\t\tconst { item_code, barcode, batch_no, serial_no, uom } = data;\n\n\t\t\tlet row = this.get_row_to_modify_on_scan(item_code, batch_no, uom, barcode);\n\n\t\t\tthis.is_new_row = false;\n\t\t\tif (!row) {\n\t\t\t\tif (this.dont_allow_new_row) {\n\t\t\t\t\tthis.show_alert(__(\"Maximum quantity scanned for item {0}.\", [item_code]), \"red\");\n\t\t\t\t\tthis.clean_up();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.is_new_row = true;\n\n\t\t\t\t// add new row if new item/batch is scanned\n\t\t\t\trow = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\t\t\t\t// trigger any row add triggers defined on child table.\n\t\t\t\tthis.frm.script_manager.trigger(`${this.items_table_name}_add`, row.doctype, row.name);\n\t\t\t\tthis.frm.has_items = false;\n\t\t\t}\n\n\t\t\tif (this.is_duplicate_serial_no(row, serial_no)) {\n\t\t\t\tthis.clean_up();\n\t\t\t\treject();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_selector_trigger_flag(data),\n\t\t\t\t() =>\n\t\t\t\t\tthis.set_item(row, item_code, barcode, batch_no, serial_no).then((qty) => {\n\t\t\t\t\t\tthis.show_scan_message(row.idx, row.item_code, qty);\n\t\t\t\t\t}),\n\t\t\t\t() => this.set_barcode_uom(row, uom),\n\t\t\t\t() => this.set_serial_no(row, serial_no),\n\t\t\t\t() => this.set_batch_no(row, batch_no),\n\t\t\t\t() => this.set_barcode(row, barcode),\n\t\t\t\t() => this.clean_up(),\n\t\t\t\t() => this.revert_selector_flag(),\n\t\t\t\t() => resolve(row),\n\t\t\t]);\n\t\t});\n\t}\n\n\t// batch and serial selector is reduandant when all info can be added by scan\n\t// this flag on item row is used by transaction.js to avoid triggering selector\n\tset_selector_trigger_flag(data) {\n\t\tconst { batch_no, serial_no, has_batch_no, has_serial_no } = data;\n\n\t\tconst require_selecting_batch = has_batch_no && !batch_no;\n\t\tconst require_selecting_serial = has_serial_no && !serial_no;\n\n\t\tif (!(require_selecting_batch || require_selecting_serial)) {\n\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t}\n\t}\n\n\trevert_selector_flag() {\n\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\tfrappe.flags.trigger_from_barcode_scanner = false;\n\t}\n\n\tset_item(row, item_code, barcode, batch_no, serial_no) {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst increment = async (value = 1) => {\n\t\t\t\tconst item_data = { item_code: item_code };\n\t\t\t\tfrappe.flags.trigger_from_barcode_scanner = true;\n\t\t\t\titem_data[this.qty_field] = Number(row[this.qty_field] || 0) + Number(value);\n\t\t\t\tawait frappe.model.set_value(row.doctype, row.name, item_data);\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tif (this.prompt_qty) {\n\t\t\t\tfrappe.prompt(__(\"Please enter quantity for item {0}\", [item_code]), ({ value }) => {\n\t\t\t\t\tincrement(value).then((value) => resolve(value));\n\t\t\t\t});\n\t\t\t} else if (this.frm.has_items) {\n\t\t\t\tthis.prepare_item_for_scan(row, item_code, barcode, batch_no, serial_no);\n\t\t\t} else {\n\t\t\t\tincrement().then((value) => resolve(value));\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_item_for_scan(row, item_code, barcode, batch_no, serial_no) {\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Scan barcode for item {0}\", [item_code]),\n\t\t\tfields: me.get_fields_for_dialog(row, item_code, barcode, batch_no, serial_no),\n\t\t});\n\n\t\tthis.dialog.set_primary_action(__(\"Update\"), () => {\n\t\t\tconst item_data = { item_code: item_code };\n\t\t\titem_data[this.qty_field] = this.dialog.get_value(\"scanned_qty\");\n\t\t\titem_data[\"has_item_scanned\"] = 1;\n\n\t\t\tthis.remaining_qty =\n\t\t\t\tflt(this.dialog.get_value(\"qty\")) - flt(this.dialog.get_value(\"scanned_qty\"));\n\t\t\tfrappe.model.set_value(row.doctype, row.name, item_data);\n\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.set_batch_no(row, this.dialog.get_value(\"batch_no\")),\n\t\t\t\t() => this.set_barcode(row, this.dialog.get_value(\"barcode\")),\n\t\t\t\t() => this.set_serial_no(row, this.dialog.get_value(\"serial_no\")),\n\t\t\t\t() => this.add_child_for_remaining_qty(row),\n\t\t\t\t() => this.clean_up(),\n\t\t\t]);\n\n\t\t\tthis.dialog.hide();\n\t\t});\n\n\t\tthis.dialog.show();\n\n\t\tthis.$scan_btn = this.dialog.$wrapper.find(\".link-btn\");\n\t\tthis.$scan_btn.css(\"display\", \"inline\");\n\t}\n\n\tget_fields_for_dialog(row, item_code, barcode, batch_no, serial_no) {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode_scanner\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Scan Barcode\"),\n\t\t\t\tonchange: (e) => {\n\t\t\t\t\tif (!e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.value) {\n\t\t\t\t\t\tthis.scan_api_call(e.target.value, (r) => {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tthis.update_dialog_values(item_code, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tfieldname: \"qty\",\n\t\t\t\tlabel: __(\"Quantity to Scan\"),\n\t\t\t\tdefault: row[this.qty_field] || 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\tfieldname: \"column_break_1\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Float\",\n\t\t\t\tread_only: 1,\n\t\t\t\tfieldname: \"scanned_qty\",\n\t\t\t\tlabel: __(\"Scanned Quantity\"),\n\t\t\t\tdefault: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t},\n\t\t];\n\n\t\tif (batch_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\toptions: \"Batch No\",\n\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\tdefault: batch_no,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1,\n\t\t\t});\n\t\t}\n\n\t\tif (serial_no) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\tlabel: __(\"Serial Nos\"),\n\t\t\t\tdefault: serial_no,\n\t\t\t\tread_only: 1,\n\t\t\t});\n\t\t}\n\n\t\tif (barcode) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tfieldname: \"barcode\",\n\t\t\t\toptions: \"Barcode\",\n\t\t\t\tlabel: __(\"Barcode\"),\n\t\t\t\tdefault: barcode,\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1,\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tupdate_dialog_values(scanned_item, r) {\n\t\tconst { item_code, barcode, batch_no, serial_no } = r.message;\n\n\t\tthis.dialog.set_value(\"barcode_scanner\", \"\");\n\t\tif (\n\t\t\titem_code === scanned_item &&\n\t\t\t(this.dialog.get_value(\"barcode\") === barcode || batch_no || serial_no)\n\t\t) {\n\t\t\tif (batch_no) {\n\t\t\t\tthis.dialog.set_value(\"batch_no\", batch_no);\n\t\t\t}\n\n\t\t\tif (serial_no) {\n\t\t\t\tthis.validate_duplicate_serial_no(serial_no);\n\t\t\t\tlet serial_nos = this.dialog.get_value(\"serial_no\") + \"\\n\" + serial_no;\n\t\t\t\tthis.dialog.set_value(\"serial_no\", serial_nos);\n\t\t\t}\n\n\t\t\tlet qty = flt(this.dialog.get_value(\"scanned_qty\")) + 1.0;\n\t\t\tthis.dialog.set_value(\"scanned_qty\", qty);\n\t\t}\n\t}\n\n\tvalidate_duplicate_serial_no(serial_no) {\n\t\tlet serial_nos = this.dialog.get_value(\"serial_no\")\n\t\t\t? this.dialog.get_value(\"serial_no\").split(\"\\n\")\n\t\t\t: [];\n\n\t\tif (in_list(serial_nos, serial_no)) {\n\t\t\tfrappe.throw(__(\"Serial No {0} already scanned\", [serial_no]));\n\t\t}\n\t}\n\n\tadd_child_for_remaining_qty(prev_row) {\n\t\tif (this.remaining_qty && this.remaining_qty > 0) {\n\t\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\t\t\tlet row = frappe.model.add_child(this.frm.doc, cur_grid.doctype, this.items_table_name);\n\n\t\t\tlet ignore_fields = [\n\t\t\t\t\"name\",\n\t\t\t\t\"idx\",\n\t\t\t\t\"batch_no\",\n\t\t\t\t\"barcode\",\n\t\t\t\t\"received_qty\",\n\t\t\t\t\"serial_no\",\n\t\t\t\t\"has_item_scanned\",\n\t\t\t];\n\n\t\t\tfor (let key in prev_row) {\n\t\t\t\tif (in_list(ignore_fields, key)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\trow[key] = prev_row[key];\n\t\t\t}\n\n\t\t\trow[this.qty_field] = this.remaining_qty;\n\t\t\tif (this.qty_field == \"qty\" && frappe.meta.has_field(row.doctype, \"stock_qty\")) {\n\t\t\t\trow[\"stock_qty\"] = this.remaining_qty * row.conversion_factor;\n\t\t\t}\n\n\t\t\tthis.frm.script_manager.trigger(\"item_code\", row.doctype, row.name);\n\t\t}\n\t}\n\n\tasync set_serial_no(row, serial_no) {\n\t\tif (serial_no && frappe.meta.has_field(row.doctype, this.serial_no_field)) {\n\t\t\tconst existing_serial_nos = row[this.serial_no_field];\n\t\t\tlet new_serial_nos = \"\";\n\n\t\t\tif (!!existing_serial_nos) {\n\t\t\t\tnew_serial_nos = existing_serial_nos + \"\\n\" + serial_no;\n\t\t\t} else {\n\t\t\t\tnew_serial_nos = serial_no;\n\t\t\t}\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.serial_no_field, new_serial_nos);\n\t\t}\n\t}\n\n\tasync set_barcode_uom(row, uom) {\n\t\tif (uom && frappe.meta.has_field(row.doctype, this.uom_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.uom_field, uom);\n\t\t}\n\t}\n\n\tasync set_batch_no(row, batch_no) {\n\t\tif (batch_no && frappe.meta.has_field(row.doctype, this.batch_no_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.batch_no_field, batch_no);\n\t\t}\n\t}\n\n\tasync set_barcode(row, barcode) {\n\t\tif (barcode && frappe.meta.has_field(row.doctype, this.barcode_field)) {\n\t\t\tawait frappe.model.set_value(row.doctype, row.name, this.barcode_field, barcode);\n\t\t}\n\t}\n\n\tshow_scan_message(idx, exist = null, qty = 1) {\n\t\t// show new row or qty increase toast\n\t\tif (exist) {\n\t\t\tthis.show_alert(__(\"Row #{0}: Qty increased by {1}\", [idx, qty]), \"green\");\n\t\t} else {\n\t\t\tthis.show_alert(__(\"Row #{0}: Item added\", [idx]), \"green\");\n\t\t}\n\t}\n\n\tis_duplicate_serial_no(row, serial_no) {\n\t\tconst is_duplicate = row[this.serial_no_field]?.includes(serial_no);\n\n\t\tif (is_duplicate) {\n\t\t\tthis.show_alert(__(\"Serial No {0} is already added\", [serial_no]), \"orange\");\n\t\t}\n\t\treturn is_duplicate;\n\t}\n\n\tget_row_to_modify_on_scan(item_code, batch_no, uom, barcode) {\n\t\tlet cur_grid = this.frm.fields_dict[this.items_table_name].grid;\n\n\t\t// Check if batch is scanned and table has batch no field\n\t\tlet is_batch_no_scan = batch_no && frappe.meta.has_field(cur_grid.doctype, this.batch_no_field);\n\t\tlet check_max_qty = this.max_qty_field && frappe.meta.has_field(cur_grid.doctype, this.max_qty_field);\n\n\t\tconst matching_row = (row) => {\n\t\t\tconst item_match = row.item_code == item_code;\n\t\t\tconst batch_match = !row[this.batch_no_field] || row[this.batch_no_field] == batch_no;\n\t\t\tconst uom_match = !uom || row[this.uom_field] == uom;\n\t\t\tconst qty_in_limit = flt(row[this.qty_field]) < flt(row[this.max_qty_field]);\n\t\t\tconst item_scanned = row.has_item_scanned;\n\n\t\t\treturn (\n\t\t\t\titem_match &&\n\t\t\t\tuom_match &&\n\t\t\t\t!item_scanned &&\n\t\t\t\t(!is_batch_no_scan || batch_match) &&\n\t\t\t\t(!check_max_qty || qty_in_limit)\n\t\t\t);\n\t\t};\n\n\t\treturn this.items_table.find(matching_row) || this.get_existing_blank_row();\n\t}\n\n\tget_existing_blank_row() {\n\t\treturn this.items_table.find((d) => !d.item_code);\n\t}\n\n\tplay_success_sound() {\n\t\tthis.success_sound && frappe.utils.play_sound(this.success_sound);\n\t}\n\n\tplay_fail_sound() {\n\t\tthis.fail_sound && frappe.utils.play_sound(this.fail_sound);\n\t}\n\n\tclean_up() {\n\t\tthis.scan_barcode_field.set_value(\"\");\n\t\trefresh_field(this.items_table_name);\n\t}\n\tshow_alert(msg, indicator, duration = 3) {\n\t\tfrappe.show_alert({ message: msg, indicator: indicator }, duration);\n\t}\n};\n", "frappe.ui.form.ControlData = class ControlData extends frappe.ui.form.ControlData {\n\tmake_input() {\n\t\tsuper.make_input();\n\t\tif (this.df.options == \"Phone\") {\n\t\t\tthis.setup_phone();\n\t\t}\n\t\tif (this.frm && this.frm.fields_dict) {\n\t\t\tObject.values(this.frm.fields_dict).forEach(function (field) {\n\t\t\t\tif (\n\t\t\t\t\tfield.df.read_only === 1 &&\n\t\t\t\t\tfield.df.options === \"Phone\" &&\n\t\t\t\t\tfield.disp_area.style[0] != \"display\" &&\n\t\t\t\t\t!field.has_icon\n\t\t\t\t) {\n\t\t\t\t\tfield.setup_phone();\n\t\t\t\t\tfield.has_icon = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tsetup_phone() {\n\t\tif (frappe.phone_call.handler) {\n\t\t\tlet control = this.df.read_only ? \".control-value\" : \".control-input\";\n\t\t\tthis.$wrapper\n\t\t\t\t.find(control)\n\t\t\t\t.append(\n\t\t\t\t\t`\n\t\t\t\t\t<span class=\"phone-btn\">\n\t\t\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Make a call\")}\">\n\t\t\t\t\t\t\t${frappe.utils.icon(\"call\")}\n\t\t\t\t\t</span>\n\t\t\t\t`\n\t\t\t\t)\n\t\t\t\t.find(\".phone-btn\")\n\t\t\t\t.click(() => {\n\t\t\t\t\tfrappe.phone_call.handler(this.get_value(), this.frm);\n\t\t\t\t});\n\t\t}\n\t}\n};\n", "\n\tfrappe.templates['call_link'] = `<div class=\"call-detail-wrapper\">\n\t<div class=\"head flex justify-between\">\n\t\t<div>\n\t\t\t<span class=\"bold\"> {{ type }} Call</span>\n\t\t\t{% if (duration) %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ frappe.format(duration, { fieldtype: \"Duration\" }) }}</span>\n\t\t\t{% endif %}\n\t\t\t<span class=\"text-muted\"> \u2022 {{ comment_when(creation) }}</span>\n\t\t</div>\n\t\t<span>\n\t\t\t<a class=\"action-btn\" href=\"/app/call-log/{{ name }}\" title=\"{{ __(\"Open Call Log\") }}\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-link-url\" class=\"like-icon\"></use>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</span>\n\t</div>\n\n\n\t<div class=\"body pt-3\">\n\t\t{% if (type === \"Incoming\") { %}\n\t\t\t<span> Incoming call from {{ from }}, received by {{ to }}</span>\n\t\t{% } else { %}\n\t\t\t<span> Outgoing Call made by {{ from }} to {{ to }}</span>\n\t\t{% } %}\n\t\t<div class=\"summary pt-3\">\n\t\t{% if (summary) { %}\n\t\t\t<i>{{ summary }}</i>\n\t\t{% } else { %}\n\t\t\t<i class=\"text-muted\">{{ __(\"No Summary\") }}</i>\n\t\t{% } %}\n\t\t</div>\n\t\t{% if (recording_url) { %}\n\t\t<div class=\"margin-top\">\n\t\t\t\t<audio\n\t\t\t\t\tcontrols\n\t\t\t\t\tsrc=\"{{ recording_url }}\">\n\t\t\t\t</audio>\n\t\t</div>\n\t\t{% } %}\n\t</div>\n</div>\n`;\n", "frappe.provide(\"erpnext.bulk_transaction_processing\");\n\n$.extend(erpnext.bulk_transaction_processing, {\n\tcreate: function (listview, from_doctype, to_doctype) {\n\t\tlet checked_items = listview.get_checked_items();\n\t\tconst doc_name = [];\n\t\tchecked_items.forEach((Item) => {\n\t\t\tif (Item.docstatus == 0) {\n\t\t\t\tdoc_name.push(Item.name);\n\t\t\t}\n\t\t});\n\n\t\tlet count_of_rows = checked_items.length;\n\t\tfrappe.confirm(__(\"Create {0} {1} ?\", [count_of_rows, to_doctype]), () => {\n\t\t\tif (doc_name.length == 0) {\n\t\t\t\tfrappe\n\t\t\t\t\t.call({\n\t\t\t\t\t\tmethod: \"erpnext.utilities.bulk_transaction.transaction_processing\",\n\t\t\t\t\t\targs: { data: checked_items, from_doctype: from_doctype, to_doctype: to_doctype },\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {});\n\t\t\t\tif (count_of_rows > 10) {\n\t\t\t\t\tfrappe.show_alert(\"Starting a background job to create {0} {1}\", [\n\t\t\t\t\t\tcount_of_rows,\n\t\t\t\t\t\tto_doctype,\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__(\"Selected document must be in submitted state\"));\n\t\t\t}\n\t\t});\n\t},\n});\n", "erpnext.utils.CRMActivities = class CRMActivities {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\t$(this.open_activities_wrapper).empty();\n\t\tlet cur_form_footer = this.form_wrapper.find(\".form-footer\");\n\n\t\t// all activities\n\t\tif (!$(this.all_activities_wrapper).find(\".form-footer\").length) {\n\t\t\tthis.all_activities_wrapper.empty();\n\t\t\t$(cur_form_footer).appendTo(this.all_activities_wrapper);\n\n\t\t\t// remove frappe-control class to avoid absolute position for action-btn\n\t\t\t$(this.all_activities_wrapper).removeClass(\"frappe-control\");\n\t\t\t// hide new event button\n\t\t\t$(\".timeline-actions\").find(\".btn-default\").hide();\n\t\t\t// hide new comment box\n\t\t\t$(\".comment-box\").hide();\n\t\t\t// show only communications by default\n\t\t\t$($(\".timeline-content\").find(\".nav-link\")[0]).tab(\"show\");\n\t\t}\n\n\t\t// open activities\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.crm.utils.get_open_activities\",\n\t\t\targs: {\n\t\t\t\tref_doctype: this.frm.doc.doctype,\n\t\t\t\tref_docname: this.frm.doc.name,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tvar activities_html = frappe.render_template(\"crm_activities\", {\n\t\t\t\t\t\ttasks: r.message.tasks,\n\t\t\t\t\t\tevents: r.message.events,\n\t\t\t\t\t});\n\n\t\t\t\t\t$(activities_html).appendTo(me.open_activities_wrapper);\n\n\t\t\t\t\t$(\".open-tasks\")\n\t\t\t\t\t\t.find(\".completion-checkbox\")\n\t\t\t\t\t\t.on(\"click\", function () {\n\t\t\t\t\t\t\tme.update_status(this, \"ToDo\");\n\t\t\t\t\t\t});\n\n\t\t\t\t\t$(\".open-events\")\n\t\t\t\t\t\t.find(\".completion-checkbox\")\n\t\t\t\t\t\t.on(\"click\", function () {\n\t\t\t\t\t\t\tme.update_status(this, \"Event\");\n\t\t\t\t\t\t});\n\n\t\t\t\t\tme.create_task();\n\t\t\t\t\tme.create_event();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tcreate_task() {\n\t\tlet me = this;\n\t\tlet _create_task = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Task\"),\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field(\"interaction_type\").set_value(\"ToDo\");\n\t\t\t// hide column having interaction type field\n\t\t\t$(composer.dialog.get_field(\"interaction_type\").wrapper).closest(\".form-column\").hide();\n\t\t\t// hide summary field\n\t\t\t$(composer.dialog.get_field(\"summary\").wrapper).closest(\".form-section\").hide();\n\t\t};\n\t\t$(\".new-task-btn\").click(_create_task);\n\t}\n\n\tcreate_event() {\n\t\tlet me = this;\n\t\tlet _create_event = () => {\n\t\t\tconst args = {\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\tfrm: me.frm,\n\t\t\t\ttitle: __(\"New Event\"),\n\t\t\t};\n\t\t\tlet composer = new frappe.views.InteractionComposer(args);\n\t\t\tcomposer.dialog.get_field(\"interaction_type\").set_value(\"Event\");\n\t\t\t$(composer.dialog.get_field(\"interaction_type\").wrapper).hide();\n\t\t};\n\t\t$(\".new-event-btn\").click(_create_event);\n\t}\n\n\tasync update_status(input_field, doctype) {\n\t\tlet completed = $(input_field).prop(\"checked\") ? 1 : 0;\n\t\tlet docname = $(input_field).attr(\"name\");\n\t\tif (completed) {\n\t\t\tawait frappe.db.set_value(doctype, docname, \"status\", \"Closed\");\n\t\t\tthis.refresh();\n\t\t}\n\t}\n};\n\nerpnext.utils.CRMNotes = class CRMNotes {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\trefresh() {\n\t\tvar me = this;\n\t\tthis.notes_wrapper.find(\".notes-section\").remove();\n\n\t\tlet notes = this.frm.doc.notes || [];\n\t\tnotes.sort(function (a, b) {\n\t\t\treturn new Date(b.added_on) - new Date(a.added_on);\n\t\t});\n\n\t\tlet notes_html = frappe.render_template(\"crm_notes\", {\n\t\t\tnotes: notes,\n\t\t});\n\t\t$(notes_html).appendTo(this.notes_wrapper);\n\n\t\tthis.add_note();\n\n\t\t$(\".notes-section\")\n\t\t\t.find(\".edit-note-btn\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tme.edit_note(this);\n\t\t\t});\n\n\t\t$(\".notes-section\")\n\t\t\t.find(\".delete-note-btn\")\n\t\t\t.on(\"click\", function () {\n\t\t\t\tme.delete_note(this);\n\t\t\t});\n\t}\n\n\tadd_note() {\n\t\tlet me = this;\n\t\tlet _add_note = () => {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Add a Note\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Note\",\n\t\t\t\t\t\tfieldname: \"note\",\n\t\t\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\t\t\treqd: 1,\n\t\t\t\t\t\tenable_mentions: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action: function () {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"add_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __(\"Add\"),\n\t\t\t});\n\t\t\td.show();\n\t\t};\n\t\t$(\".new-note-btn\").click(_add_note);\n\t}\n\n\tedit_note(edit_btn) {\n\t\tvar me = this;\n\t\tlet row = $(edit_btn).closest(\".comment-content\");\n\t\tlet row_id = row.attr(\"name\");\n\t\tlet row_content = $(row).find(\".content\").html();\n\t\tif (row_content) {\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: __(\"Edit Note\"),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"Note\",\n\t\t\t\t\t\tfieldname: \"note\",\n\t\t\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\t\t\tdefault: row_content,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action: function () {\n\t\t\t\t\tvar data = d.get_values();\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"edit_note\",\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tnote: data.note,\n\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprimary_action_label: __(\"Done\"),\n\t\t\t});\n\t\t\td.show();\n\t\t}\n\t}\n\n\tdelete_note(delete_btn) {\n\t\tvar me = this;\n\t\tlet row_id = $(delete_btn).closest(\".comment-content\").attr(\"name\");\n\t\tfrappe.call({\n\t\t\tmethod: \"delete_note\",\n\t\t\tdoc: me.frm.doc,\n\t\t\targs: {\n\t\t\t\trow_id: row_id,\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tme.frm.refresh_field(\"notes\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n};\n", "\n\tfrappe.templates['crm_activities'] = `<div class=\"open-activities\">\n\t<div class=\"new-btn pb-3\">\n\t\t<span>\n\t\t\t<button class=\"btn btn-sm small new-task-btn mr-1\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Task\") }}\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-sm small new-event-btn\">\n\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t<use href=\"#icon-calendar\"></use>\n\t\t\t\t</svg>\n\t\t\t\t{{ __(\"New Event\") }}\n\t\t\t</button>\n\t\t</span>\n\t</div>\n\t<div class=\"section-body\">\n\t\t<div class=\"open-tasks pr-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Tasks\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (tasks.length) { %}\n\t\t\t\t{% for(var i=0, l=tasks.length; i<l; i++) { %}\n\t\t\t\t\t<div class=\"single-activity\">\n\t\t\t\t\t\t<div class=\"flex justify-between mb-2\">\n\t\t\t\t\t\t\t<div class=\"row label-area font-md ml-1\">\n\t\t\t\t\t\t\t\t<span class=\"mr-2\">\n\t\t\t\t\t\t\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t\t\t\t\t\t\t<use href=\"#icon-small-message\"></use>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<a href=\"/app/todo/{{ tasks[i].name }}\" title=\"{{ __('Open Task') }}\">\n\t\t\t\t\t\t\t\t\t{%= tasks[i].description %}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"checkbox\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"completion-checkbox\"\n\t\t\t\t\t\t\t\t\tname=\"{{tasks[i].name}}\" title=\"{{ __('Mark As Closed') }}\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% if(tasks[i].date) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted ml-1\">\n\t\t\t\t\t\t\t\t{%= frappe.datetime.global_date_format(tasks[i].date) %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t{% if(tasks[i].allocated_to) { %}\n\t\t\t\t\t\t\t<div class=\"text-muted  ml-1\">\n\t\t\t\t\t\t\t\t{{ __(\"Allocated To:\") }}\n\t\t\t\t\t\t\t\t{%= tasks[i].allocated_to %}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t\t</div>\n\t\t\t    {% } %}\n            {% } else { %}\n                <div class=\"single-activity no-activity text-muted\">\n                    {{ __(\"No open task\") }}\n                </div>\n\t\t    {% } %}\n\t\t</div>\n\t\t<div class=\"open-events pl-1\">\n\t\t\t<div class=\"open-section-head\">\n\t\t\t\t<span class=\"ml-2\">{{ __(\"Open Events\") }}</span>\n\t\t\t</div>\n\t\t\t{% if (events.length) { %}\n                {% let icon_set = {\"Sent/Received Email\": \"mail\", \"Call\": \"call\", \"Meeting\": \"share-people\"}; %}\n                {% for(var i=0, l=events.length; i<l; i++) { %}\n                    <div class=\"single-activity\">\n                        <div class=\"flex justify-between mb-2\">\n                            <div class=\"row label-area font-md ml-1 title\">\n                                <span class=\"mr-2\">\n                                    <svg class=\"icon icon-sm\">\n                                        <use href=\"#icon-{{ icon_set[events[i].event_category] || 'calendar' }}\"></use>\n                                    </svg>\n                                </span>\n                                <a href=\"/app/event/{{ events[i].name }}\" title=\"{{ __('Open Event') }}\">\n                                    {%= events[i].subject %}\n                                </a>\n                            </div>\n                            <div class=\"checkbox\">\n                                <input type=\"checkbox\" class=\"completion-checkbox\"\n                                    name=\"{{ events[i].name }}\" title=\"{{ __('Mark As Closed') }}\">\n                            </div>\n                        </div>\n                        <div class=\"text-muted ml-1\">\n                            {%= frappe.datetime.global_date_format(events[i].starts_on) %}\n\n                            {% if (events[i].ends_on) { %}\n                                {% if (frappe.datetime.obj_to_user(events[i].starts_on) != frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    -\n                                    {%= frappe.datetime.global_date_format(frappe.datetime.obj_to_user(events[i].ends_on)) %}\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } else if (events[i].ends_on) { %}\n                                    -\n                                    {%= frappe.datetime.get_time(events[i].ends_on) %}\n                                {% } %}\n                            {% } %}\n\n                        </div>\n                    </div>\n                {% } %}\n            {% } else { %}\n            <div class=\"single-activity no-activity text-muted\">\n                {{ __(\"No open event\") }}\n            </div>\n\t\t    {% } %}\n\t\t</div>\n\t</div>\n</div>\n\n\n<style>\n.open-activities {\n\tmin-height: 50px;\n\tpadding-left: 0px;\n\tpadding-bottom: 15px !important;\n}\n\n.open-activities .new-btn {\n\ttext-align: right;\n}\n\n.single-activity {\n\tmin-height: 90px;\n\tborder: 1px solid var(--border-color);\n\tpadding: 10px;\n\tborder-bottom: 0;\n\tpadding-right: 0;\n}\n\n.single-activity:last-child {\n\tborder-bottom: 1px solid var(--border-color);\n}\n\n.single-activity:hover .completion-checkbox{\n\tdisplay: block;\n}\n\n.completion-checkbox {\n\tvertical-align: middle;\n\tdisplay: none;\n}\n\n.checkbox {\n\tmin-width: 22px;\n}\n\n.open-tasks {\n\twidth: 50%;\n}\n\n.open-tasks:first-child {\n\tborder-right: 0;\n}\n\n.open-events {\n\twidth: 50%;\n}\n\n.open-section-head {\n\tbackground-color: var(--bg-color);\n\tmin-height: 30px;\n\tborder-bottom: 1px solid var(--border-color);\n\tpadding: 10px;\n\tfont-weight: bold;\n}\n\n.no-activity {\n    text-align: center;\n    padding-top: 30px;\n}\n\n.form-footer {\n\tbackground-color: var(--bg-color);\n}\n</style>`;\n", "\n\tfrappe.templates['crm_notes'] = `<div class=\"notes-section col-xs-12\">\n\t<div class=\"new-btn pb-3\">\n\t\t<button class=\"btn btn-sm small new-note-btn mr-1\">\n\t\t\t<svg class=\"icon icon-sm\">\n\t\t\t\t<use href=\"#icon-add\"></use>\n\t\t\t</svg>\n\t\t\t{{ __(\"New Note\") }}\n\t\t</button>\n\t</div>\n\t<div class=\"all-notes\">\n\t\t{% if (notes.length) { %}\n\t\t\t{% for(var i=0, l=notes.length; i<l; i++) { %}\n\t\t\t\t<div class=\"comment-content p-3 row\" name=\"{{ notes[i].name }}\">\n\t\t\t\t\t<div class=\"mb-2 head col-xs-3\">\n\t\t\t\t\t\t{% if (notes[i].added_by && notes[i].added_on) %}\n\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-xs-2\">\n\t\t\t\t\t\t\t\t{{ frappe.avatar(notes[i].added_by) }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"col-xs-10\">\n\t\t\t\t\t\t\t\t<div class=\"mr-2 title font-weight-bold ellipsis\" title=\"{{ strip_html(notes[i].added_by) }}\">\n\t\t\t\t\t\t\t\t\t{{ strip_html(notes[i].added_by) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"time small text-muted\">\n\t\t\t\t\t\t\t\t\t{{ frappe.datetime.global_date_format(notes[i].added_on) }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{% } %}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"content col-xs-8\">\n\t\t\t\t\t\t{{ notes[i].note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"col-xs-1 text-right\">\n\t\t\t\t\t\t<span class=\"edit-note-btn btn btn-link\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-sm\"><use xlink:href=\"#icon-edit\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"delete-note-btn  btn btn-link pl-2\">\n\t\t\t\t\t\t\t<svg class=\"icon icon-xs\"><use xlink:href=\"#icon-delete\"></use></svg>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{% } %}\n\t\t{% } else { %}\n            <div class=\"no-activity text-muted pt-6\">\n                {{ __(\"No Notes\") }}\n            </div>\n\t\t    {% } %}\n\t</div>\n</div>\n\n<style>\n\n.comment-content {\n    border: 1px solid var(--border-color);\n\tborder-bottom: none;\n}\n\n.comment-content:last-child {\n    border-bottom: 1px solid var(--border-color);\n}\n\n.new-btn {\n\ttext-align: right;\n}\n\n.notes-section .no-activity {\n\tmin-height: 100px;\n\ttext-align: center;\n}\n\n.notes-section .btn {\n\tpadding: 0.2rem 0.2rem;\n}\n\n</style>`;\n"],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACArC,SAAO,UAAU,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;",
  "names": []
}
